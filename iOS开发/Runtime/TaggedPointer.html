
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>TaggedPointer · 个人博客</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="苏沫漓">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-anchor-navigation-ex/style/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-tbfed-pagefooter/footer.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="编译objc4.html" />
    
    
    <link rel="prev" href="+load方法的调用历程.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../../计算机基础/计算机基础.html">
            
                <a href="../../计算机基础/计算机基础.html">
            
                    
                    计算机基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../../计算机基础/计算机组成篇/计算机概述篇.html">
            
                <a href="../../计算机基础/计算机组成篇/计算机概述篇.html">
            
                    
                    第一部分 计算机的组成
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../../计算机基础/计算机组成篇/计算机组成篇.html">
            
                <a href="../../计算机基础/计算机组成篇/计算机组成篇.html">
            
                    
                    计算机组成篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../../计算机基础/计算机组成篇/计算机计算篇.html">
            
                <a href="../../计算机基础/计算机组成篇/计算机计算篇.html">
            
                    
                    计算机计算篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../../计算机基础/操作系统篇/操作系统基础篇.html">
            
                <a href="../../计算机基础/操作系统篇/操作系统基础篇.html">
            
                    
                    第二部分 操作系统篇
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.2.1" data-path="../../计算机基础/操作系统篇/进程管理篇.html">
            
                <a href="../../计算机基础/操作系统篇/进程管理篇.html">
            
                    
                    进程管理篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.2" data-path="../../计算机基础/操作系统篇/内存管理篇.html">
            
                <a href="../../计算机基础/操作系统篇/内存管理篇.html">
            
                    
                    内存管理篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.3" data-path="../../计算机基础/操作系统篇/文件系统篇.html">
            
                <a href="../../计算机基础/操作系统篇/文件系统篇.html">
            
                    
                    文件系统篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2.4" data-path="../../计算机基础/操作系统篇/操作系统提升篇.html">
            
                <a href="../../计算机基础/操作系统篇/操作系统提升篇.html">
            
                    
                    操作系统提升篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../../计算机基础/计算机网络/网络概述篇.html">
            
                <a href="../../计算机基础/计算机网络/网络概述篇.html">
            
                    
                    第三部分 网络篇
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.1" data-path="../../计算机基础/计算机网络/计算机物理层.html">
            
                <a href="../../计算机基础/计算机网络/计算机物理层.html">
            
                    
                    计算机物理层
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.2" data-path="../../计算机基础/计算机网络/计算机数据链路层.html">
            
                <a href="../../计算机基础/计算机网络/计算机数据链路层.html">
            
                    
                    计算机数据链路层
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.3" data-path="../../计算机基础/计算机网络/计算机网络层.html">
            
                <a href="../../计算机基础/计算机网络/计算机网络层.html">
            
                    
                    计算机网络层
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.4" data-path="../../计算机基础/计算机网络/计算机传输层.html">
            
                <a href="../../计算机基础/计算机网络/计算机传输层.html">
            
                    
                    计算机传输层
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5" data-path="../../计算机基础/计算机网络/计算机应用层.html">
            
                <a href="../../计算机基础/计算机网络/计算机应用层.html">
            
                    
                    计算机应用层
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.3.5.1" data-path="../../计算机基础/计算机网络/HTTP协议.html">
            
                <a href="../../计算机基础/计算机网络/HTTP协议.html">
            
                    
                    HTTP协议
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3.5.2" data-path="../../计算机基础/计算机网络/HTTPS协议.html">
            
                <a href="../../计算机基础/计算机网络/HTTPS协议.html">
            
                    
                    HTTPS协议
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    iOS开发
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" >
            
                <span>
            
                    
                    Runtime
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1.1" data-path="OC之Blocks.html">
            
                <a href="OC之Blocks.html">
            
                    
                    OC之Blocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.2" data-path="OC内存管理.html">
            
                <a href="OC内存管理.html">
            
                    
                    OC内存管理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.3" data-path="OC内存管理之引用计数.html">
            
                <a href="OC内存管理之引用计数.html">
            
                    
                    OC内存管理之引用计数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.4" data-path="+load方法的调用历程.html">
            
                <a href="+load方法的调用历程.html">
            
                    
                    +load方法
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.1.5" data-path="TaggedPointer.html">
            
                <a href="TaggedPointer.html">
            
                    
                    TaggedPointer
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.6" data-path="编译objc4.html">
            
                <a href="编译objc4.html">
            
                    
                    编译objc4备忘录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.7" data-path="Runtime_Protocol.html">
            
                <a href="Runtime_Protocol.html">
            
                    
                    Runtime函数库中关于协议Protocol的函数使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.8" data-path="Runtime_Property.html">
            
                <a href="Runtime_Property.html">
            
                    
                    Runtime函数库中关于属性与变量的函数使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.9" data-path="Runtime_Instance.html">
            
                <a href="Runtime_Instance.html">
            
                    
                    Runtime函数库中关于实例对象的函数使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.10" data-path="Runtime_Class.html">
            
                <a href="Runtime_Class.html">
            
                    
                    Runtime函数库中关于Class的函数使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.1.11" data-path="Runtime_Method.html">
            
                <a href="Runtime_Method.html">
            
                    
                    Runtime函数库中关于 Class 的函数使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../CoreText/CoteText概述.html">
            
                <a href="../CoreText/CoteText概述.html">
            
                    
                    CoreText
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.2.1" data-path="../CoreText/CoteText排版与布局.html">
            
                <a href="../CoreText/CoteText排版与布局.html">
            
                    
                    CoteText排版与布局
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.2" data-path="../CoreText/CTLineRef的函数库及使用.html">
            
                <a href="../CoreText/CTLineRef的函数库及使用.html">
            
                    
                    CTLineRef的函数库及使用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2.3" data-path="../CoreText/CTRunRef与CTRunDelegate.html">
            
                <a href="../CoreText/CTRunRef与CTRunDelegate.html">
            
                    
                    图文混排的关键：CTRunRef 与 CTRunDelegate
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.3" >
            
                <span>
            
                    
                    CoreImage
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.3.1" data-path="../CoreImage/图像特征CIFeature.html">
            
                <a href="../CoreImage/图像特征CIFeature.html">
            
                    
                    图像特征CIFeature
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3.2" data-path="../CoreImage/图片检测CIDetector.html">
            
                <a href="../CoreImage/图片检测CIDetector.html">
            
                    
                    图片检测CIDetector
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal简介.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal简介.html">
            
                    
                    Metal 用例
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.4.1" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal的简单计算.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal的简单计算.html">
            
                    
                    内核计算
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.2" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal绘制三角形.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal绘制三角形.html">
            
                    
                    绘制三角形
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.3" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/CPU与GPU协调工作.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/CPU与GPU协调工作.html">
            
                    
                    CPU与GPU协调工作
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.4" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/深度测试.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/深度测试.html">
            
                    
                    深度测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.5" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/读取纹理像素.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/读取纹理像素.html">
            
                    
                    线程与线程组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.6" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/读取纹理像素.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/读取纹理像素.html">
            
                    
                    读取绘制纹理中的像素数据
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4.7" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/离屏渲染.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/离屏渲染.html">
            
                    
                    自定义MTLRenderPassDescriptor
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal调试.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal调试.html">
            
                    
                    调试 Metal 程序
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal简介.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/Metal简介.html">
            
                    
                    Metal 文档
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.6.1" data-path="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/MTKView.html">
            
                <a href="../../计算机基础/计算机图形学/Graphics_Metal/MetalDocument/MTKView.html">
            
                    
                    MTKView 的使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7" >
            
                <span>
            
                    
                    杂记
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.7.1" data-path="../杂记/iOS渲染机制初窥.html">
            
                <a href="../杂记/iOS渲染机制初窥.html">
            
                    
                    iOS渲染机制初窥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.2" data-path="../杂记/响应链.html">
            
                <a href="../杂记/响应链.html">
            
                    
                    响应链
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.3" data-path="../杂记/并发编程.html">
            
                <a href="../杂记/并发编程.html">
            
                    
                    并发编程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.7.3.1" data-path="../杂记/OC之Thread.html">
            
                <a href="../杂记/OC之Thread.html">
            
                    
                    线程NSThread
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.3.2" data-path="../杂记/OC之NSOperation.html">
            
                <a href="../杂记/OC之NSOperation.html">
            
                    
                    任务队列NSOperation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.3.3" data-path="../杂记/OC之GCD.html">
            
                <a href="../杂记/OC之GCD.html">
            
                    
                    GCD
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.7.4" data-path="../杂记/OC的深拷贝与浅拷贝.html">
            
                <a href="../杂记/OC的深拷贝与浅拷贝.html">
            
                    
                    OC的深拷贝与浅拷贝
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.5" data-path="../../其它/sdk_cocoapods.html">
            
                <a href="../../其它/sdk_cocoapods.html">
            
                    
                    iOS 使用 cocoapods 创建组件化库
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.6" data-path="../杂记/内存优化.html">
            
                <a href="../杂记/内存优化.html">
            
                    
                    一些内存优化
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.7" data-path="../杂记/内存泄露.html">
            
                <a href="../杂记/内存泄露.html">
            
                    
                    一些内存泄漏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.8" data-path="../杂记/刘海屏适配.html">
            
                <a href="../杂记/刘海屏适配.html">
            
                    
                    刘海屏适配
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7.9" data-path="../杂记/获取WIFI信息.html">
            
                <a href="../杂记/获取WIFI信息.html">
            
                    
                    获取WIFI信息
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    C/C++
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" >
            
                <span>
            
                    
                    C++
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../../C_C++篇/C++学习入门篇.html">
            
                <a href="../../C_C++篇/C++学习入门篇.html">
            
                    
                    C++学习入门篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../../C_C++篇/C++学习封装篇.html">
            
                <a href="../../C_C++篇/C++学习封装篇.html">
            
                    
                    C++学习封装篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../../C_C++篇/C++学习继承篇.html">
            
                <a href="../../C_C++篇/C++学习继承篇.html">
            
                    
                    C++学习继承篇
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="../../C_C++篇/C++学习多态篇.html">
            
                <a href="../../C_C++篇/C++学习多态篇.html">
            
                    
                    C++学习多态篇
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" >
            
                <span>
            
                    
                    C
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.2.1" data-path="../../C_C++篇/C数组.html">
            
                <a href="../../C_C++篇/C数组.html">
            
                    
                    C语言数组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.2" data-path="../../C_C++篇/C结构.html">
            
                <a href="../../C_C++篇/C结构.html">
            
                    
                    C语言结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2.3" data-path="../../C_C++篇/C递归.html">
            
                <a href="../../C_C++篇/C递归.html">
            
                    
                    递归
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    其它
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../../Git体系/Git常用命令.html">
            
                <a href="../../Git体系/Git常用命令.html">
            
                    
                    Git常用命令
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../../Git体系/Github和SSH密钥.html">
            
                <a href="../../Git体系/Github和SSH密钥.html">
            
                    
                    Github和SSH密钥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../../Gitbook指导/">
            
                <a href="../../Gitbook指导/">
            
                    
                    GitBook 使用教程
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../../Gitbook指导/gitbook教程.html">
            
                <a href="../../Gitbook指导/gitbook教程.html">
            
                    
                    GitBook 安装
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3.2" data-path="../../Gitbook指导/gitbook语法.html">
            
                <a href="../../Gitbook指导/gitbook语法.html">
            
                    
                    GitBook 使用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.sumoli.work" target="blank" class="gitbook-link">
            博客主页
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >TaggedPointer</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <div id="anchor-navigation-ex-navbar"><i class="fa fa-navicon"></i><ul><li><span class="title-icon "></span><a href="#&#x4F2A;&#x6307;&#x9488;-tagged-pointer"><b></b>&#x4F2A;&#x6307;&#x9488; Tagged Pointer</a></li><li><span class="title-icon "></span><a href="#1&#x3001;tagged-pointer-&#x4ECB;&#x7ECD;"><b></b>1&#x3001;Tagged Pointer &#x4ECB;&#x7ECD;</a></li><ul><li><span class="title-icon "></span><a href="#11&#x3001;&#x4EC0;&#x4E48;&#x662F;-tagged-pointer-&#xFF1F;"><b></b>1.1&#x3001;&#x4EC0;&#x4E48;&#x662F; Tagged Pointer &#xFF1F;</a></li><li><span class="title-icon "></span><a href="#12&#x3001;-tagged-pointer-&#x51FA;&#x73B0;&#x7684;&#x80CC;&#x666F;"><b></b>1.2&#x3001; Tagged Pointer &#x51FA;&#x73B0;&#x7684;&#x80CC;&#x666F;</a></li><li><span class="title-icon "></span><a href="#13&#x3001;&#x82F9;&#x679C;&#x5BF9;-tagged-pointer-&#x7684;&#x4ECB;&#x7ECD;"><b></b>1.3&#x3001;&#x82F9;&#x679C;&#x5BF9; Tagged Pointer &#x7684;&#x4ECB;&#x7ECD;</a></li><li><span class="title-icon "></span><a href="#14&#x3001;tagged-pointer-&#x7684;&#x4F7F;&#x7528;"><b></b>1.4&#x3001;Tagged Pointer &#x7684;&#x4F7F;&#x7528;</a></li><li><span class="title-icon "></span><a href="#15&#x3001;tagged-pointer-&#x7684;&#x601D;&#x8003;"><b></b>1.5&#x3001;Tagged Pointer &#x7684;&#x601D;&#x8003;</a></li></ul><li><span class="title-icon "></span><a href="#2&#x3001;tagged-pointer-&#x7684;&#x5E95;&#x5C42;&#x63A2;&#x7A76;"><b></b>2&#x3001;Tagged Pointer &#x7684;&#x5E95;&#x5C42;&#x63A2;&#x7A76;</a></li><ul><li><span class="title-icon "></span><a href="#21&#x3001;tagged-pointer-&#x6280;&#x672F;&#x7684;&#x542F;&#x7528;&#x4E0E;&#x7981;&#x7528;"><b></b>2.1&#x3001;Tagged Pointer &#x6280;&#x672F;&#x7684;&#x542F;&#x7528;&#x4E0E;&#x7981;&#x7528;</a></li><ul><li><span class="title-icon "></span><a href="#211&#x3001;tagged-pointer-&#x7684;&#x7981;&#x7528;&#x51FD;&#x6570;"><b></b>2.1.1&#x3001;Tagged Pointer &#x7684;&#x7981;&#x7528;&#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#212&#x3001;&#x4F55;&#x65F6;&#x8C03;&#x7528;-disabletaggedpointers-&#x51FD;&#x6570;"><b></b>2.1.2&#x3001;&#x4F55;&#x65F6;&#x8C03;&#x7528; disableTaggedPointers() &#x51FD;&#x6570;?</a></li><li><span class="title-icon "></span><a href="#213&#x3001;&#x5224;&#x65AD;&#x662F;&#x5426;&#x7981;&#x7528;&#x7684;&#x51FD;&#x6570;"><b></b>2.1.3&#x3001;&#x5224;&#x65AD;&#x662F;&#x5426;&#x7981;&#x7528;&#x7684;&#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#214&#x3001;&#x80FD;&#x5426;&#x7981;&#x7528;&#xFF1F;"><b></b>2.1.4&#x3001;&#x80FD;&#x5426;&#x7981;&#x7528;&#xFF1F;</a></li></ul><li><span class="title-icon "></span><a href="#22&#x3001;&#x6CE8;&#x518C;&#x6210;&#x4E3A;tagged-pointer"><b></b>2.2&#x3001;&#x6CE8;&#x518C;&#x6210;&#x4E3A;Tagged Pointer</a></li><ul><li><span class="title-icon "></span><a href="#221&#x3001;classslotforbasictagindex-&#x51FD;&#x6570;"><b></b>2.2.1&#x3001;classSlotForBasicTagIndex() &#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#222&#x3001;classslotfortagindex-&#x51FD;&#x6570;"><b></b>2.2.2&#x3001;classSlotForTagIndex() &#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#223&#x3001;&#x7D22;&#x5F15;objctagindext"><b></b>2.2.3&#x3001;&#x7D22;&#x5F15;objc_tag_index_t</a></li><li><span class="title-icon "></span><a href="#224&#x3001;objcregistertaggedpointerclass-&#x51FD;&#x6570;"><b></b>2.2.4&#x3001;_objc_registerTaggedPointerClass() &#x51FD;&#x6570;</a></li><li><span class="title-icon "></span><a href="#225&#x3001;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;tagged-pointer"><b></b>2.2.5&#x3001;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;Tagged Pointer</a></li><li><span class="title-icon "></span><a href="#226&#x3001;&#x83B7;&#x53D6;objcregistertaggedpointerclass&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;"><b></b>2.2.6&#x3001;&#x83B7;&#x53D6;_objc_registerTaggedPointerClass()&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;</a></li></ul><li><span class="title-icon "></span><a href="#23&#x3001;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x662F;&#x5426;&#x662F;-tagged-pointer"><b></b>2.3&#x3001;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x662F;&#x5426;&#x662F; Tagged Pointer</a></li><li><span class="title-icon "></span><a href="#24&#x3001;&#x5728;&#x4F2A;&#x6307;&#x9488;-tagged-pointer-&#x5B58;&#x50A8;&#x6570;&#x636E;"><b></b>2.4&#x3001;&#x5728;&#x4F2A;&#x6307;&#x9488; Tagged Pointer &#x5B58;&#x50A8;&#x6570;&#x636E;</a></li><li><span class="title-icon "></span><a href="#25&#x3001;tagged-pointer-&#x7684;&#x6570;&#x636E;&#x6DF7;&#x6DC6;"><b></b>2.5&#x3001;Tagged Pointer &#x7684;&#x6570;&#x636E;&#x6DF7;&#x6DC6;</a></li><ul><li><span class="title-icon "></span><a href="#251&#x3001;tagged-pointer-&#x6570;&#x636E;&#x6DF7;&#x6DC6;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x542F;&#x4E0E;&#x5173;&#x95ED;"><b></b>2.5.1&#x3001;Tagged Pointer &#x6570;&#x636E;&#x6DF7;&#x6DC6;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x542F;&#x4E0E;&#x5173;&#x95ED;</a></li><li><span class="title-icon "></span><a href="#252&#x3001;objcdebugtaggedpointerobfuscator&#x7684;&#x4F7F;&#x7528;"><b></b>2.5.2&#x3001;objc_debug_taggedpointer_obfuscator&#x7684;&#x4F7F;&#x7528;</a></li></ul><li><span class="title-icon "></span><a href="#26&#x3001;&#x83B7;&#x53D6;tagged-pointer-&#x7684;&#x6570;&#x636E;"><b></b>2.6&#x3001;&#x83B7;&#x53D6;Tagged Pointer &#x7684;&#x6570;&#x636E;</a></li><li><span class="title-icon "></span><a href="#27&#x3001;tagged-pointer-&#x5176;&#x4ED6;&#x51FD;&#x6570;"><b></b>2.7&#x3001;Tagged Pointer &#x5176;&#x4ED6;&#x51FD;&#x6570;</a></li></ul></ul></div><h1 id="&#x4F2A;&#x6307;&#x9488;-tagged-pointer"><a name="&#x4F2A;&#x6307;&#x9488;-tagged-pointer" class="anchor-navigation-ex-anchor" href="#&#x4F2A;&#x6307;&#x9488;-tagged-pointer"><i class="fa fa-link" aria-hidden="true"></i></a>&#x4F2A;&#x6307;&#x9488; <code>Tagged Pointer</code></h1>
<h1 id="1&#x3001;tagged-pointer-&#x4ECB;&#x7ECD;"><a name="1&#x3001;tagged-pointer-&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#1&#x3001;tagged-pointer-&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>1&#x3001;<code>Tagged Pointer</code> &#x4ECB;&#x7ECD;</h1>
<h2 id="11&#x3001;&#x4EC0;&#x4E48;&#x662F;-tagged-pointer-&#xFF1F;"><a name="11&#x3001;&#x4EC0;&#x4E48;&#x662F;-tagged-pointer-&#xFF1F;" class="anchor-navigation-ex-anchor" href="#11&#x3001;&#x4EC0;&#x4E48;&#x662F;-tagged-pointer-&#xFF1F;"><i class="fa fa-link" aria-hidden="true"></i></a>1.1&#x3001;&#x4EC0;&#x4E48;&#x662F; <code>Tagged Pointer</code> &#xFF1F;</h2>
<p><code>Tagged Pointer</code> &#x662F;&#x4E00;&#x4E2A;&#x7279;&#x522B;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x5B83;&#x5206;&#x4E3A;&#x4E24;&#x90E8;&#x5206;&#xFF1A;</p>
<ul>
<li>&#x4E00;&#x90E8;&#x5206;&#x76F4;&#x63A5;&#x4FDD;&#x5B58;&#x6570;&#x636E; &#xFF1B;</li>
<li>&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x4F5C;&#x4E3A;&#x7279;&#x6B8A;&#x6807;&#x8BB0;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x522B;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x4E0D;&#x6307;&#x5411;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#xFF1B;</li>
</ul>
<p>&#x56E0;&#x6B64;&#xFF0C;&#x6211;&#x4EEC;&#x8BF4;<code>Tagged Pointer</code> &#x662F;&#x4E00;&#x4E2A;&#x4F2A;&#x6307;&#x9488;&#xFF01;</p>
<h2 id="12&#x3001;-tagged-pointer-&#x51FA;&#x73B0;&#x7684;&#x80CC;&#x666F;"><a name="12&#x3001;-tagged-pointer-&#x51FA;&#x73B0;&#x7684;&#x80CC;&#x666F;" class="anchor-navigation-ex-anchor" href="#12&#x3001;-tagged-pointer-&#x51FA;&#x73B0;&#x7684;&#x80CC;&#x666F;"><i class="fa fa-link" aria-hidden="true"></i></a>1.2&#x3001; <code>Tagged Pointer</code> &#x51FA;&#x73B0;&#x7684;&#x80CC;&#x666F;</h2>
<p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A; <code>NSNumber</code> &#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x50A8;<code>NSInteger</code>&#x7684;&#x666E;&#x901A;&#x53D8;&#x91CF;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x6240;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x662F;&#x4E0E; CPU &#x7684;&#x4F4D;&#x6570;&#x6709;&#x5173;&#xFF0C;&#x5728; 32 &#x4F4D;CPU&#x4E0B;&#x5360;4&#x4E2A;&#x5B57;&#x8282;&#x3002;&#x800C;&#x6307;&#x9488;&#x7C7B;&#x578B;&#x7684;&#x5927;&#x5C0F;&#x901A;&#x5E38;&#x4E5F;&#x662F;&#x4E0E; CPU &#x4F4D;&#x6570;&#x76F8;&#x5173;&#xFF0C;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x6240;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x5728;32&#x4F4D;CPU&#x4E0B;&#x4E3A;4&#x4E2A;&#x5B57;&#x8282;&#x3002;</p>
<p>&#x5728;2013&#x5E74;9&#x6708;&#xFF0C;&#x82F9;&#x679C;&#x63A8;&#x51FA;&#x4E86;iPhone 5s&#xFF0C;&#x8BE5;&#x6B3E;&#x673A;&#x578B;&#x9996;&#x6B21;&#x91C7;&#x7528;64&#x4F4D;&#x67B6;&#x6784;&#x7684;A7&#x53CC;&#x6838;&#x5904;&#x7406;&#x5668;&#x3002;&#x6B64;&#x65F6;&#xFF0C;&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;<code>NSNumber</code>&#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x679C;&#x5B58;&#x50A8;<code>NSInteger</code>&#x7684;&#x666E;&#x901A;&#x53D8;&#x91CF;&#xFF0C;&#x90A3;&#x4E48;&#x5B83;&#x5C06;&#x5360; 8 &#x4E2A;&#x5B57;&#x8282;&#xFF1B;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x4E5F;&#x5C06;&#x5360;&#x7528; 8 &#x4E2A;&#x5B57;&#x8282;&#x3002;</p>
<p>&#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x666E;&#x901A;&#x7684;&#x7A0B;&#x5E8F;&#x800C;&#x8A00;&#xFF0C;&#x4ECE; 32 &#x4F4D;&#x673A;&#x5668;&#x8FC1;&#x79FB;&#x5230; 64 &#x4F4D;&#x673A;&#x5668;&#x4E2D;&#x540E;&#xFF0C;&#x867D;&#x7136;&#x903B;&#x8F91;&#x6CA1;&#x6709;&#x4EFB;&#x4F55;&#x53D8;&#x5316;&#xFF0C;&#x4F46;&#x5BF9;&#x4E8E; <code>NSNumber</code>&#x3001;<code>NSDate</code>&#x3001;<code>NSString</code>&#x7B49;&#x7C7B;&#x578B;&#x7684;&#x5B9E;&#x4F8B;&#x6240;&#x5360;&#x7528;&#x7684;&#x5185;&#x5B58;&#x4F1A;&#x7FFB;&#x500D;&#x3001;&#x6D6A;&#x8D39;&#x4E86;&#x7A00;&#x6709;&#x7684;&#x5185;&#x5B58;&#x8D44;&#x6E90;&#xFF01;&#xFF01;&#x540C;&#x65F6;&#x7EF4;&#x62A4;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x9700;&#x8981;&#x4E5F;&#x5206;&#x914D;&#x5185;&#x5B58;&#xFF0C;&#x7EF4;&#x62A4;&#x5F15;&#x7528;&#x8BA1;&#x6570;&#xFF0C;&#x7BA1;&#x7406;&#x751F;&#x547D;&#x5468;&#x671F;&#xFF0C;&#x4F7F;&#x7528;&#x5BF9;&#x8C61;&#x7ED9;&#x7A0B;&#x5E8F;&#x7684;&#x8FD0;&#x884C;&#x589E;&#x52A0;&#x4E86;&#x8D1F;&#x62C5;&#xFF01;&#xFF01;</p>
<p>&#x4E3A;&#x4E86;&#x8282;&#x7701;&#x5185;&#x5B58;&#x548C;&#x63D0;&#x9AD8;&#x6267;&#x884C;&#x6548;&#x7387;&#xFF0C;&#x82F9;&#x679C;&#x63D0;&#x51FA;&#x4E86; <code>Tagged Pointer</code> &#x7684;&#x6982;&#x5FF5;&#x3002;&#x82F9;&#x679C;&#x5C06;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x6307;&#x9488;&#x62C6;&#x6210;&#x4E24;&#x90E8;&#x5206;&#xFF0C;&#x4E00;&#x90E8;&#x5206;&#x76F4;&#x63A5;&#x4FDD;&#x5B58;&#x6570;&#x636E;&#xFF0C;&#x53E6;&#x4E00;&#x90E8;&#x5206;&#x4F5C;&#x4E3A;&#x7279;&#x6B8A;&#x6807;&#x8BB0;&#xFF0C;&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x7279;&#x522B;&#x7684;&#x6307;&#x9488;&#xFF0C;&#x4E0D;&#x6307;&#x5411;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;&#x5730;&#x5740;&#x3002;</p>
<h2 id="13&#x3001;&#x82F9;&#x679C;&#x5BF9;-tagged-pointer-&#x7684;&#x4ECB;&#x7ECD;"><a name="13&#x3001;&#x82F9;&#x679C;&#x5BF9;-tagged-pointer-&#x7684;&#x4ECB;&#x7ECD;" class="anchor-navigation-ex-anchor" href="#13&#x3001;&#x82F9;&#x679C;&#x5BF9;-tagged-pointer-&#x7684;&#x4ECB;&#x7ECD;"><i class="fa fa-link" aria-hidden="true"></i></a>1.3&#x3001;&#x82F9;&#x679C;&#x5BF9; <code>Tagged Pointer</code> &#x7684;&#x4ECB;&#x7ECD;</h2>
<p>&#x82F9;&#x679C;&#x5BF9;&#x4E8E; <code>Tagged Pointer</code> &#x7279;&#x70B9;&#x7684;&#x505A;&#x51FA;&#x4E86;&#x4ECB;&#x7ECD;:</p>
<ul>
<li><code>Tagged Pointer</code> &#x88AB;&#x8BBE;&#x8BA1;&#x7684;&#x76EE;&#x7684;&#x662F;&#x7528;&#x6765;&#x5B58;&#x50A8;&#x8F83;&#x5C0F;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4F8B;&#x5982;<code>NSNumber</code>&#x3001;<code>NSDate</code>&#x3001;<code>NSString</code> &#x7B49;&#xFF1B;</li>
<li><code>Tagged Pointer</code> &#x7684;&#x503C;&#x4E0D;&#x518D;&#x8868;&#x793A;&#x5730;&#x5740;&#xFF0C;&#x800C;&#x662F;&#x771F;&#x6B63;&#x7684;&#x503C;&#xFF1B;</li>
<li>&#x5728;&#x5185;&#x5B58;&#x8BFB;&#x53D6;&#x4E0A;&#x6709;&#x7740;3&#x500D;&#x7684;&#x6548;&#x7387;&#xFF0C;&#x521B;&#x5EFA;&#x65F6;&#x6BD4;&#x4EE5;&#x524D;&#x5FEB;106&#x500D; &#xFF1B;</li>
</ul>
<h2 id="14&#x3001;tagged-pointer-&#x7684;&#x4F7F;&#x7528;"><a name="14&#x3001;tagged-pointer-&#x7684;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#14&#x3001;tagged-pointer-&#x7684;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>1.4&#x3001;<code>Tagged Pointer</code> &#x7684;&#x4F7F;&#x7528;</h2>
<p>&#x5728;&#x4E00;&#x4E2A;&#x7A0B;&#x5E8F;&#x4E2D;&#x8FD0;&#x884C;&#x4E0B;&#x8FF0;&#x4EE3;&#x7801;&#xFF0C;&#x83B7;&#x53D6;&#x8F93;&#x51FA;&#x65E5;&#x5FD7;&#xFF1A;</p>
<pre><code>NSNumber *number =  @(0);
NSNumber *number1 = @(1);
NSNumber *number2 = @(2);
NSNumber *number3 = @(9999999999999999999);
NSString *string = [[@&quot;a&quot; mutableCopy] copy];
NSIndexPath *indexPath = [NSIndexPath indexPathForRow:0 inSection:0];

NSLog(@&quot;number ---- %@, %p&quot;, [number class], number);
NSLog(@&quot;number1 --- %@, %p&quot;, [number1 class], number1);
NSLog(@&quot;number2 --- %@, %p&quot;, [number2 class], number2);
NSLog(@&quot;number3 --- %@, %p&quot;, [number3 class], number3);
NSLog(@&quot;NSString -- %@, %p&quot;, [string class], string);
NSLog(@&quot;indexPath - %@, %p&quot;, indexPath.class,indexPath);

/********************* &#x8F93;&#x51FA;&#x65E5;&#x5FD7; *********************
number ---- __NSCFNumber, 0xb000000000000002
number1 --- __NSCFNumber, 0xb000000000000012
number2 --- __NSCFNumber, 0xb000000000000022
number3 --- __NSCFNumber, 0x600003b791c0
NSString -- NSTaggedPointerString, 0xa000000000000611
indexPath - NSIndexPath, 0xc000000000000016
*/
</code></pre><p>&#x5206;&#x6790;&#x65E5;&#x5FD7;&#xFF1A;</p>
<ul>
<li>1&#x3001;<code>NSNumber</code>&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x4E0D;&#x5927;&#x65F6;&#xFF0C;<code>NSNumber *</code>&#x6307;&#x9488;&#x662F;&#x4F2A;&#x6307;&#x9488;<code>Tagged Pointer</code> &#xFF1B;</li>
<li>2&#x3001;<code>NSNumber</code>&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x5F88;&#x5927;&#x65F6;&#xFF0C;<code>NSNumber *</code>&#x6307;&#x9488;&#x4E00;&#x822C;&#x6307;&#x9488;&#xFF0C;&#x6307;&#x5411;<code>NSNumber</code>&#x5B9E;&#x4F8B;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x5982; <code>number3</code>&#xFF1B;</li>
<li>3&#x3001;<code>NSTaggedPointerString</code> &#x7ECF;&#x5E38;&#x9047;&#x89C1;&#xFF0C;&#x5B83;&#x5C31;&#x662F;<code>Tagged Pointer</code> &#x5BF9;&#x8C61;&#xFF1B;</li>
</ul>
<p>&#x5BF9;&#x4E8E;<code>Tagged Pointer</code> &#xFF0C;&#x662F;&#x7CFB;&#x7EDF;&#x5B9E;&#x73B0;&#x7684;&#xFF0C;&#x65E0;&#x9700;&#x5F00;&#x53D1;&#x8005;&#x64CD;&#x5FC3;&#xFF01;&#x4F46;&#x662F;&#x4F5C;&#x4E3A;&#x5F00;&#x53D1;&#x8005;&#xFF0C;&#x4E5F;&#x8981;&#x77E5;&#x9053;<code>NSTaggedPointerString</code>&#x7B49;&#x662F;&#x4EC0;&#x4E48;&#x4E1C;&#x897F;&#xFF01;</p>
<h2 id="15&#x3001;tagged-pointer-&#x7684;&#x601D;&#x8003;"><a name="15&#x3001;tagged-pointer-&#x7684;&#x601D;&#x8003;" class="anchor-navigation-ex-anchor" href="#15&#x3001;tagged-pointer-&#x7684;&#x601D;&#x8003;"><i class="fa fa-link" aria-hidden="true"></i></a>1.5&#x3001;<code>Tagged Pointer</code> &#x7684;&#x601D;&#x8003;</h2>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x6587;&#x7684;&#x6982;&#x5FF5; + &#x5E94;&#x7528;&#xFF0C;&#x76F8;&#x4FE1;&#x5927;&#x5BB6;&#x5BF9; <code>Tagged Pointer</code>  &#x6709;&#x4E86;&#x4E00;&#x5B9A;&#x7684;&#x4E86;&#x89E3;&#xFF1B;&#x90A3;&#x4E48;&#x5927;&#x5BB6;&#x6709;&#x6CA1;&#x6709;&#x4E00;&#x4E9B;&#x7591;&#x95EE;&#x5462;&#xFF1F;</p>
<ul>
<li>&#x7CFB;&#x7EDF;&#x662F;&#x5982;&#x4F55;&#x5C06; <code>NSNumber</code>&#x3001;<code>NSDate</code>&#x3001;<code>NSString</code>&#x7B49;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x5B58;&#x50A8;&#x5728; <code>Tagged Pointer</code>  &#x4E0A;&#xFF1F;</li>
<li>&#x65E2;&#x7136;<code>Tagged Pointer</code> &#x662F;&#x4E00;&#x4E2A;&#x4F2A;&#x6307;&#x9488;&#xFF0C;&#x4E0D;&#x518D;&#x6307;&#x5411;&#x5B9E;&#x4F8B;&#x5BF9;&#x8C61;&#xFF0C;&#x90A3;&#x4E48;<code>isa</code>&#x6307;&#x9488;&#x5C31;&#x4E0D;&#x80FD;&#x518D;&#x8C03;&#x7528;&#xFF01;&#x4E0D;&#x901A;&#x8FC7;<code>isa</code>&#x6307;&#x9488;&#x83B7;&#x53D6;&#x5B83;&#x6240;&#x5C5E;&#x7684;&#x7C7B;&#xFF0C;&#x7CFB;&#x7EDF;&#x662F;&#x5982;&#x4F55;&#x77E5;&#x9053;&#x5B83;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x7684;&#xFF1F;</li>
<li>&#x6570;&#x636E;&#x5C55;&#x793A;&#x5728;<code>Tagged Pointer</code> &#xFF0C;&#x53EF;&#x4EE5;&#x88AB;&#x4EBA;&#x901A;&#x8FC7;<code>Tagged Pointer</code> &#x83B7;&#x53D6;&#xFF0C;&#x660E;&#x663E;&#x4E0D;&#x518D;&#x5B89;&#x5168;&#xFF0C;&#x90A3;&#x4E48;&#x82F9;&#x679C;&#x662F;&#x5982;&#x4F55;&#x52A0;&#x5BC6;<code>Tagged Pointer</code> &#x4E0A;&#x7684;&#x6570;&#x636E;&#x7684;&#xFF1F;</li>
</ul>
<h1 id="2&#x3001;tagged-pointer-&#x7684;&#x5E95;&#x5C42;&#x63A2;&#x7A76;"><a name="2&#x3001;tagged-pointer-&#x7684;&#x5E95;&#x5C42;&#x63A2;&#x7A76;" class="anchor-navigation-ex-anchor" href="#2&#x3001;tagged-pointer-&#x7684;&#x5E95;&#x5C42;&#x63A2;&#x7A76;"><i class="fa fa-link" aria-hidden="true"></i></a>2&#x3001;<code>Tagged Pointer</code> &#x7684;&#x5E95;&#x5C42;&#x63A2;&#x7A76;</h1>
<p>&#x82F9;&#x679C;&#x8BBE;&#x8BA1;&#x7684; <code>Tagged Pointer</code> &#x6280;&#x672F;&#xFF0C;&#x662F;&#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x4E2D;&#x5B9E;&#x73B0;&#x7684;&#x3002;</p>
<p>&#x5173;&#x4E8E;  <code>Tagged Pointer</code> &#x6280;&#x672F;&#x7684;&#x4E00;&#x4E9B;&#x5B8F;&#x5B9A;&#x4E49;&#xFF1A;</p>
<pre><code>#if !__LP64__ /// 32 &#x4F4D;&#x673A;&#x5668;&#xFF0C;&#x4E0D;&#x652F;&#x6301; Tagged Pointer
#   define SUPPORT_TAGGED_POINTERS 0
#else
#   define SUPPORT_TAGGED_POINTERS 1
#endif

#if __arm64__
// ARM64 &#x6307;&#x4EE4;&#x96C6;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x79CD;&#x65B0;&#x7684; TaggedPointers &#x65B9;&#x6848;&#xFF1A;&#x666E;&#x901A;&#x6807;&#x8BB0;&#x4F4D;&#x4E8E;&#x4F4E;&#x4F4D;&#xFF0C;&#x6269;&#x5C55;&#x6807;&#x8BB0;&#x4F4D;&#x4E8E;&#x9AD8;&#x4F4D;&#xFF0C;&#x5E76;&#x4E14;&#x4E00;&#x534A;&#x7684;&#x6269;&#x5C55;&#x6807;&#x8BB0;&#x7A7A;&#x95F4;&#x9884;&#x7559;&#x7ED9;&#x672A;&#x6DF7;&#x6DC6;&#x7684;&#x6709;&#x6548;&#x8D1F;&#x8F7D;
#   define OBJC_SPLIT_TAGGED_POINTERS 1
#else
#   define OBJC_SPLIT_TAGGED_POINTERS 0
#endif


#if (TARGET_OS_OSX || TARGET_OS_MACCATALYST) &amp;&amp; __x86_64__
    // 64 &#x4F4D;&#x7684; Mac - tag bit is LSB
#   define OBJC_MSB_TAGGED_POINTERS 0
#else
    // &#x5176;&#x4F59;&#x7CFB;&#x7EDF; - tag bit is MSB
#   define OBJC_MSB_TAGGED_POINTERS 1
#endif
</code></pre><h2 id="21&#x3001;tagged-pointer-&#x6280;&#x672F;&#x7684;&#x542F;&#x7528;&#x4E0E;&#x7981;&#x7528;"><a name="21&#x3001;tagged-pointer-&#x6280;&#x672F;&#x7684;&#x542F;&#x7528;&#x4E0E;&#x7981;&#x7528;" class="anchor-navigation-ex-anchor" href="#21&#x3001;tagged-pointer-&#x6280;&#x672F;&#x7684;&#x542F;&#x7528;&#x4E0E;&#x7981;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1&#x3001;<code>Tagged Pointer</code> &#x6280;&#x672F;&#x7684;&#x542F;&#x7528;&#x4E0E;&#x7981;&#x7528;</h2>
<p>&#x82F9;&#x679C;&#x9884;&#x7559;&#x4E86;&#x73AF;&#x5883;&#x53D8;&#x91CF; <code>OBJC_DISABLE_TAGGED_POINTERS</code>&#xFF0C;&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x8BE5;&#x53D8;&#x91CF;&#x7684;&#x5E03;&#x5C14;&#x503C;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;<code>Tagged Pointer</code> &#x6280;&#x672F;&#x7684;&#x542F;&#x7528;&#x4E0E;&#x5173;&#x95ED;&#x7684;&#x51B3;&#x5B9A;&#x6743;&#x4EA4;&#x7ED9;&#x5F00;&#x53D1;&#x8005;&#xFF01;
&#x5982;&#x679C;&#x7981;&#x7528;<code>Tagged Pointer</code> &#xFF0C;&#x53EA;&#x9700;&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF; <code>OBJC_DISABLE_TAGGED_POINTERS</code>&#x4E3A;<code>YES</code> &#x5373;&#x53EF;&#xFF01;</p>
<h3 id="211&#x3001;tagged-pointer-&#x7684;&#x7981;&#x7528;&#x51FD;&#x6570;"><a name="211&#x3001;tagged-pointer-&#x7684;&#x7981;&#x7528;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#211&#x3001;tagged-pointer-&#x7684;&#x7981;&#x7528;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.1&#x3001;<code>Tagged Pointer</code> &#x7684;&#x7981;&#x7528;&#x51FD;&#x6570;</h3>
<p><a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684; <code>objc-runtime-new.mm</code>&#x6587;&#x4EF6;&#x4E2D;&#x6709;&#x4E00;&#x4E2A;&#x7981;&#x7528;<code>Tagged Pointer</code> &#x7684;&#x51FD;&#x6570;&#xFF1A;</p>
<pre><code>static void disableTaggedPointers(){
    objc_debug_taggedpointer_mask = 0;
    objc_debug_taggedpointer_slot_shift = 0;
    objc_debug_taggedpointer_slot_mask = 0;
    objc_debug_taggedpointer_payload_lshift = 0;
    objc_debug_taggedpointer_payload_rshift = 0;

    objc_debug_taggedpointer_ext_mask = 0;
    objc_debug_taggedpointer_ext_slot_shift = 0;
    objc_debug_taggedpointer_ext_slot_mask = 0;
    objc_debug_taggedpointer_ext_payload_lshift = 0;
    objc_debug_taggedpointer_ext_payload_rshift = 0;
}
</code></pre><p>&#x5728;&#x8BE5;&#x51FD;&#x6570;&#x5185;&#x90E8;&#xFF0C;&#x5C06;&#x4E00;&#x4E9B;&#x5217;&#x53D8;&#x91CF;&#x5168;&#x90E8;&#x8BBE;&#x7F6E;&#x4E3A; <code>0</code> &#xFF01;&#x81F3;&#x4E8E;&#x8FD9;&#x4E9B;&#x53D8;&#x91CF;&#x90FD;&#x6709;&#x4EC0;&#x4E48;&#x7528;&#x5904;&#xFF0C;&#x6211;&#x4EEC;&#x540E;&#x6587;&#x7528;&#x5230;&#x4E86;&#x518D;&#x89E3;&#x91CA;&#xFF01;</p>
<h3 id="212&#x3001;&#x4F55;&#x65F6;&#x8C03;&#x7528;-disabletaggedpointers-&#x51FD;&#x6570;"><a name="212&#x3001;&#x4F55;&#x65F6;&#x8C03;&#x7528;-disabletaggedpointers-&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#212&#x3001;&#x4F55;&#x65F6;&#x8C03;&#x7528;-disabletaggedpointers-&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.2&#x3001;&#x4F55;&#x65F6;&#x8C03;&#x7528; <code>disableTaggedPointers()</code> &#x51FD;&#x6570;?</h3>
<p>&#x4F55;&#x65F6;&#x8C03;&#x7528; <code>disableTaggedPointers()</code> &#x51FD;&#x6570;&#x7981;&#x7528; <code>Tagged Pointer</code> &#x5462;&#xFF1F;</p>
<p>&#x8FD8;&#x662F;&#x5728; <code>objc-runtime-new.mm</code> &#x6587;&#x4EF6;&#x4E2D;&#xFF0C;&#x5728;&#x5927;&#x540D;&#x9F0E;&#x9F0E;&#x7684; <code>_read_images()</code> &#x51FD;&#x6570;&#x4E2D;&#x6709;&#x4E00;&#x5904;&#x5173;&#x952E;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code>/// &#x6CE8;&#x610F;&#xFF1A;&#x7531;&#x4E8E;_read_images() &#x51FD;&#x6570;&#x4E2D;&#x5B8C;&#x6210;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x521D;&#x59CB;&#x5316;&#x64CD;&#x4F5C;&#xFF0C;&#x6211;&#x4EEC;&#x5728;&#x6B64;&#x5904;&#x7701;&#x7565;&#x5927;&#x91CF;&#x65E0;&#x5173;&#x4EE3;&#x7801;&#xFF0C;
void _read_images(header_info **hList, uint32_t hCount, int totalClasses, int unoptimizedTotalClasses){
        //&#x7981;&#x7528;NSNumber&#x7B49;&#x7684; Tagged Pointer &#x6307;&#x9488;&#x4F18;&#x5316;
        if (DisableTaggedPointers) {
            disableTaggedPointers();
        }

        //&#x521D;&#x59CB;&#x5316; TaggedPointer &#x6DF7;&#x6DC6;&#x5668;&#xFF1A;&#x7528;&#x4E8E;&#x4FDD;&#x62A4; Tagged Pointer &#x4E0A;&#x7684;&#x6570;&#x636E;
        initializeTaggedPointerObfuscator();
}
</code></pre><p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x9996;&#x5148;&#x5224;&#x65AD;<code>Tagged Pointer</code> &#x662F;&#x5426;&#x88AB;&#x7981;&#x7528;&#xFF0C;&#x5982;&#x679C;&#x88AB;&#x7981;&#x7528;&#xFF0C;&#x624D;&#x8C03;&#x7528;<code>disableTaggedPointers()</code>&#x51FD;&#x6570;&#x5C06;<code>Tagged Pointer</code> &#x76F8;&#x5173;&#x53D8;&#x91CF;&#x5168;&#x90E8;&#x8BBE;&#x7F6E;&#x4E3A; 0&#x3002;</p>
<pre><code>OPTION( DisableTaggedPointers,  OBJC_DISABLE_TAGGED_POINTERS,  &quot;disable tagged pointer optimization of NSNumber et al.&quot;)
</code></pre><p>&#x5224;&#x65AD; <code>Tagged Pointer</code> &#x65F6;&#xFF0C;&#x4F7F;&#x7528;&#x7684;&#x662F;&#x9884;&#x5B9A;&#x4E49;&#x7684;&#x5B8F; <code>OPTION</code>&#xFF01;&#x672C;&#x8D28;&#x662F;&#x83B7;&#x53D6;&#x73AF;&#x5883;&#x53D8;&#x91CF; <code>OBJC_DISABLE_TAGGED_POINTERS</code>&#x7684;&#x503C;&#xFF0C;&#x8BBE;&#x7F6E;&#x8BE5;&#x53D8;&#x91CF;&#x4E3A; <code>YES</code>&#xFF0C;&#x5219;<code>Tagged Pointer</code> &#x88AB;&#x7981;&#x7528;&#x3002;</p>
<h3 id="213&#x3001;&#x5224;&#x65AD;&#x662F;&#x5426;&#x7981;&#x7528;&#x7684;&#x51FD;&#x6570;"><a name="213&#x3001;&#x5224;&#x65AD;&#x662F;&#x5426;&#x7981;&#x7528;&#x7684;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#213&#x3001;&#x5224;&#x65AD;&#x662F;&#x5426;&#x7981;&#x7528;&#x7684;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.3&#x3001;&#x5224;&#x65AD;&#x662F;&#x5426;&#x7981;&#x7528;&#x7684;&#x51FD;&#x6570;</h3>
<pre><code>static inline bool  _objc_taggedPointersEnabled(void){
    extern uintptr_t objc_debug_taggedpointer_mask;
    return (objc_debug_taggedpointer_mask != 0);
}
</code></pre><ul>
<li><code>DisableTaggedPointers</code> &#x901A;&#x8FC7;&#x73AF;&#x5883;&#x53D8;&#x91CF; <code>OBJC_DISABLE_TAGGED_POINTERS</code> &#x6765;&#x5224;&#x65AD;&#x662F;&#x5426;&#x4F7F;&#x7528; <code>Tagged Pointer</code> &#xFF1B;</li>
<li>&#x51FD;&#x6570; <code>_objc_taggedPointersEnabled()</code> &#x901A;&#x8FC7;&#x5168;&#x5C40;&#x53D8;&#x91CF;<code>objc_debug_taggedpointer_mask</code>&#x5224;&#x65AD;&#x662F;&#x5426;&#x4F7F;&#x7528;<code>Tagged Pointer</code> &#x3002;</li>
</ul>
<h3 id="214&#x3001;&#x80FD;&#x5426;&#x7981;&#x7528;&#xFF1F;"><a name="214&#x3001;&#x80FD;&#x5426;&#x7981;&#x7528;&#xFF1F;" class="anchor-navigation-ex-anchor" href="#214&#x3001;&#x80FD;&#x5426;&#x7981;&#x7528;&#xFF1F;"><i class="fa fa-link" aria-hidden="true"></i></a>2.1.4&#x3001;&#x80FD;&#x5426;&#x7981;&#x7528;&#xFF1F;</h3>
<p>&#x53EF;&#x80FD;&#x6709;&#x7684;&#x8BFB;&#x8005;&#x53BB;&#x6D4B;&#x8BD5; <code>OBJC_DISABLE_TAGGED_POINTERS</code> &#x4E3A; <code>YES</code> &#x65F6;&#xFF0C;&#x53D1;&#x73B0;&#x7A0B;&#x5E8F;&#x62A5;&#x9519;&#xFF1A;</p>
<pre><code>objc[3658]: tagged pointers are disabled
Message from debugger: Terminated due to signal 9
</code></pre><p>&#x65E2;&#x7136;&#x82F9;&#x679C;&#x7ED9;&#x4E86;<code>OBJC_DISABLE_TAGGED_POINTERS</code>&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x53D8;&#x91CF;&#x8BA9;&#x6211;&#x4EEC;&#x8BBE;&#x7F6E;&#xFF0C;&#x4E3A;&#x4F55;&#x7A0B;&#x5E8F;&#x8FD8;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#x5462;&#xFF1F;&#x5206;&#x6790;&#x4E0B;&#x56FE;&#x9519;&#x8BEF;&#x5806;&#x6808;&#xFF1A;</p>
<p><img src="assets/DISABLE_TAGGED.png" alt="&#x7981;&#x7528;tagged pointers&#x65F6;&#x7684;&#x5D29;&#x6E83;&#x4FE1;&#x606F;"></p>
<p>&#x5728;&#x8C03;&#x7528;&#x6808;&#x4E2D;&#x53D1;&#x73B0;&#x4E86;<a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x6740;&#x624B; <code>_objc_fatal()</code>&#x51FD;&#x6570;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x4E00;&#x8A00;&#x4E0D;&#x5408;&#x5C31;&#x6740;&#x6B7B;&#x8FDB;&#x7A0B;&#xFF01;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x662F;<code>_objc_registerTaggedPointerClass()</code> &#x51FD;&#x6570;&#x8BF7;&#x6C42;<code>_objc_fatal()</code>&#x6740;&#x6B7B;&#x7A0B;&#x5E8F;&#x7684;&#xFF01;</p>
<p>&#x90A3;&#x4E48;<code>_objc_registerTaggedPointerClass()</code> &#x51FD;&#x6570;&#x662F;&#x4EC0;&#x4E48;&#x5462;&#xFF1F;&#x5B83;&#x51ED;&#x4EC0;&#x4E48;&#x4E00;&#x8A00;&#x4E0D;&#x5408;&#x5C31;&#x6740;&#x6B7B;&#x7A0B;&#x5E8F;&#xFF1F;&#x6211;&#x4EEC;&#x4E0B;&#x8282;&#x5206;&#x6790;&#xFF01;</p>
<h2 id="22&#x3001;&#x6CE8;&#x518C;&#x6210;&#x4E3A;tagged-pointer"><a name="22&#x3001;&#x6CE8;&#x518C;&#x6210;&#x4E3A;tagged-pointer" class="anchor-navigation-ex-anchor" href="#22&#x3001;&#x6CE8;&#x518C;&#x6210;&#x4E3A;tagged-pointer"><i class="fa fa-link" aria-hidden="true"></i></a>2.2&#x3001;&#x6CE8;&#x518C;&#x6210;&#x4E3A;<code>Tagged Pointer</code></h2>
<p>&#x4E3A;&#x4EC0;&#x4E48;<code>NSNumber</code>&#x3001;<code>NSDate</code>&#x3001;<code>NSString</code>&#x7B49;&#x7C7B;&#x578B;&#x53EF;&#x4EE5;&#x81EA;&#x52A8;&#x8F6C;&#x4E3A;<code>Tagged Pointer</code> &#xFF1F;&#x800C;<code>UIViewController</code>&#x5C31;&#x4E0D;&#x80FD;&#x81EA;&#x52A8;&#x8F6C;&#x5316;&#x5462;&#xFF1F;&#x8FD9;&#x5C31;&#x8981;&#x8BF4;&#x5230;&#x4E0A;&#x8282;&#x9057;&#x7559;&#x7684;<code>_objc_registerTaggedPointerClass()</code> &#x51FD;&#x6570;&#x4E86;&#xFF01;&#xFF01;</p>
<p><img src="assets/_objc_registerTaggedPointerClass.png" alt="_objc_registerTaggedPointerClass &#x8C03;&#x7528;"></p>
<p>&#x52A0;&#x8F7D;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x4ECE; <a href="https://opensource.apple.com/tarballs/dyld/" target="_blank">dyld2 &#x5E93;</a> &#x7684;<code>_dyld_start()</code>&#x51FD;&#x6570;&#x5F00;&#x59CB;&#xFF0C;&#x7ECF;&#x5386;&#x4E86;&#x591A;&#x822C;&#x6B65;&#x9AA4;&#xFF0C;&#x5F00;&#x59CB;&#x8C03;&#x7528;<code>_objc_registerTaggedPointerClass()</code> &#x51FD;&#x6570;&#xFF01;</p>
<p>&#x5728;&#x8BB2;&#x89E3;<code>_objc_registerTaggedPointerClass()</code> &#x51FD;&#x6570;&#x4E4B;&#x524D;&#x5148;&#x8BF4;&#x8BF4;&#x9898;&#x5916;&#x8BDD;&#xFF1A;<code>classSlotForBasicTagIndex()</code> &#x51FD;&#x6570;&#x4E0E; <code>classSlotForTagIndex()</code> &#x51FD;&#x6570;&#xFF01;</p>
<h3 id="221&#x3001;classslotforbasictagindex-&#x51FD;&#x6570;"><a name="221&#x3001;classslotforbasictagindex-&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#221&#x3001;classslotforbasictagindex-&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.1&#x3001;<code>classSlotForBasicTagIndex()</code> &#x51FD;&#x6570;</h3>
<pre><code>static Class *classSlotForBasicTagIndex(objc_tag_index_t tag){
    uintptr_t tagObfuscator = ((objc_debug_taggedpointer_obfuscator &gt;&gt; _OBJC_TAG_INDEX_SHIFT) &amp; _OBJC_TAG_INDEX_MASK);
    uintptr_t obfuscatedTag = tag ^ tagObfuscator;
    // objc_tag_classes &#x6570;&#x7EC4;&#x7684;&#x7D22;&#x5F15;&#x5305;&#x542B;&#x6807;&#x8BB0;&#x7684;&#x4F4D;&#x672C;&#x8EAB;

#if SUPPORT_MSB_TAGGED_POINTERS//&#x9AD8;&#x4F4D;&#x4F18;&#x5148;
    return &amp;objc_tag_classes[0x8 | obfuscatedTag];
#else
    return &amp;objc_tag_classes[(obfuscatedTag &lt;&lt; 1) | 1];
#endif
}
</code></pre><p><code>classSlotForBasicTagIndex()</code> &#x51FD;&#x6570;&#x7684;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x6839;&#x636E;&#x6307;&#x5B9A;&#x7D22;&#x5F15; <code>tag</code> &#x4ECE;&#x6570;&#x7EC4; <code>objc_tag_classes</code>&#x4E2D;&#x83B7;&#x53D6;&#x7C7B;&#x6307;&#x9488;&#xFF1B;&#x8BE5;&#x51FD;&#x6570;&#x8981;&#x6C42;&#x7D22;&#x5F15;<code>tag</code>&#x662F;&#x4E2A;&#x6709;&#x6548;&#x7684;&#x7D22;&#x5F15;&#xFF01;</p>
<p><em>&#x6CE8;&#xFF1A;&#x53EF;&#x80FD;&#x5927;&#x5BB6;&#x4F1A;&#x5BF9; <code>objc_debug_taggedpointer_obfuscator</code> &#x4EA7;&#x751F;&#x7591;&#x60D1;&#xFF0C;&#x8FD9;&#x4E2A;&#x4E1C;&#x897F;&#x662F;&#x4EC0;&#x4E48;?&#x662F;&#x7528;&#x6765;&#x5E72;&#x561B;&#x7684;&#xFF1F;&#x522B;&#x6025;&#xFF0C;&#x5728;&#x6B64;&#x5904;&#x4E0D;&#x5F71;&#x54CD;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x540E;&#x6587;&#x7528;&#x5230;&#x4E86;&#x6211;&#x4EEC;&#x518D;&#x8BB2;&#xFF01;</em></p>
<h6 id="a&#x3001;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x6570;&#x7EC4;&#xFF1A;"><a name="a&#x3001;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x6570;&#x7EC4;&#xFF1A;" class="anchor-navigation-ex-anchor" href="#a&#x3001;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x6570;&#x7EC4;&#xFF1A;"><i class="fa fa-link" aria-hidden="true"></i></a>a&#x3001;&#x8FD9;&#x91CC;&#x6709;&#x4E24;&#x4E2A;&#x91CD;&#x8981;&#x7684;&#x5168;&#x5C40;&#x53D8;&#x91CF;&#x6570;&#x7EC4;&#xFF1A;</h6>
<pre><code>#if SUPPORT_TAGGED_POINTERS //&#x652F;&#x6301; Tagged Pointer

extern &quot;C&quot; {
    extern Class objc_debug_taggedpointer_classes[_OBJC_TAG_SLOT_COUNT*2];
    extern Class objc_debug_taggedpointer_ext_classes[_OBJC_TAG_EXT_SLOT_COUNT];
}
#define objc_tag_classes objc_debug_taggedpointer_classes
#define objc_tag_ext_classes objc_debug_taggedpointer_ext_classes
#endif
</code></pre><ul>
<li>&#x6570;&#x7EC4; <code>objc_tag_classes</code>&#xFF1A;&#x5B58;&#x50A8;&#x82F9;&#x679C;&#x5B9A;&#x4E49;&#x7684;&#x51E0;&#x4E2A;&#x57FA;&#x7840;&#x7C7B;&#xFF1B;</li>
<li>&#x6570;&#x7EC4; <code>objc_tag_ext_classes</code> &#xFF1A;&#x5B58;&#x50A8;&#x82F9;&#x679C;&#x9884;&#x7559;&#x7684;&#x6269;&#x5C55;&#x7C7B;&#xFF1B;</li>
</ul>
<h6 id="b&#x3001;&#x6570;&#x7EC4;-objcdebugtaggedpointerclasses-&#x4E0E;-objcdebugtaggedpointerextclasses-&#x7684;&#x521D;&#x59CB;&#x5316;"><a name="b&#x3001;&#x6570;&#x7EC4;-objcdebugtaggedpointerclasses-&#x4E0E;-objcdebugtaggedpointerextclasses-&#x7684;&#x521D;&#x59CB;&#x5316;" class="anchor-navigation-ex-anchor" href="#b&#x3001;&#x6570;&#x7EC4;-objcdebugtaggedpointerclasses-&#x4E0E;-objcdebugtaggedpointerextclasses-&#x7684;&#x521D;&#x59CB;&#x5316;"><i class="fa fa-link" aria-hidden="true"></i></a>b&#x3001;&#x6570;&#x7EC4; <code>objc_debug_taggedpointer_classes</code> &#x4E0E; <code>objc_debug_taggedpointer_ext_classes</code> &#x7684;&#x521D;&#x59CB;&#x5316;</h6>
<p>&#x7B14;&#x8005;&#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684;<code>objc-msg-armXX.s</code>&#x6587;&#x4EF6;&#x53D1;&#x73B0;&#x4E86;&#x76F8;&#x5173;&#x4EE3;&#x7801;&#xFF1A;</p>
<pre><code>#if SUPPORT_TAGGED_POINTERS
    .data
    .align 3
    .globl _objc_debug_taggedpointer_classes
_objc_debug_taggedpointer_classes:
    .fill 16, 8, 0
    .globl _objc_debug_taggedpointer_ext_classes
_objc_debug_taggedpointer_ext_classes:
    .fill 256, 8, 0
#endif
</code></pre><p><em>&#x6CE8;&#xFF1A;&#x5728;&#x522B;&#x7684;&#x5730;&#x65B9;&#x6CA1;&#x6709;&#x5173;&#x4E8E;&#x8FD9;&#x4E24;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x4EE3;&#x7801;&#xFF0C;&#x7B14;&#x8005;&#x6000;&#x7591;&#x8FD9;&#x4FE9;&#x4E2A;&#x6570;&#x7EC4;&#x5728;&#x6B64;&#x5904;&#x88AB;&#x521D;&#x59CB;&#x5316;&#x7684;&#xFF01;&#x5982;&#x679C;&#x6709;&#x5927;&#x795E;&#x8BA4;&#x4E3A;&#x7B14;&#x8005;&#x9519;&#x4E86;&#xFF0C;&#x8FD9;&#x4FE9;&#x4E2A;&#x6570;&#x7EC4;&#x7684;&#x521D;&#x59CB;&#x5316;&#x53E6;&#x6709;&#x5730;&#x65B9;&#xFF0C;&#x8FD8;&#x671B;&#x544A;&#x77E5;&#xFF01;</em></p>
<h3 id="222&#x3001;classslotfortagindex-&#x51FD;&#x6570;"><a name="222&#x3001;classslotfortagindex-&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#222&#x3001;classslotfortagindex-&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.2&#x3001;<code>classSlotForTagIndex()</code> &#x51FD;&#x6570;</h3>
<pre><code>static Class *classSlotForTagIndex(objc_tag_index_t tag){
    if (tag &gt;= OBJC_TAG_First60BitPayload &amp;&amp; tag &lt;= OBJC_TAG_Last60BitPayload) {
        return classSlotForBasicTagIndex(tag);
    }

    if (tag &gt;= OBJC_TAG_First52BitPayload &amp;&amp; tag &lt;= OBJC_TAG_Last52BitPayload) {
        int index = tag - OBJC_TAG_First52BitPayload;
        uintptr_t tagObfuscator = ((objc_debug_taggedpointer_obfuscator &gt;&gt; _OBJC_TAG_EXT_INDEX_SHIFT)&amp; _OBJC_TAG_EXT_INDEX_MASK);
        return &amp;objc_tag_ext_classes[index ^ tagObfuscator];
    }
    return nil;
}
</code></pre><p>&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#x5C31;&#x662F;&#x6839;&#x636E;&#x6307;&#x5B9A;&#x7D22;&#x5F15; <code>tag</code> &#x83B7;&#x53D6;&#x7C7B;&#x6307;&#x9488;&#xFF1A;</p>
<ul>
<li>&#x5F53;&#x7D22;&#x5F15;<code>tag</code>&#x4E3A;&#x57FA;&#x7840;&#x7C7B;&#x7684;&#x7D22;&#x5F15;&#x65F6;&#xFF0C;&#x53BB;&#x6570;&#x7EC4;<code>objc_tag_classes</code>&#x4E2D;&#x53D6;&#x6570;&#x636E;&#xFF1B;</li>
<li>&#x5F53;&#x7D22;&#x5F15;<code>tag</code>&#x4E3A;&#x6269;&#x5C55;&#x7C7B;&#x7684;&#x7D22;&#x5F15;&#x65F6;&#xFF0C;&#x53BB;&#x6570;&#x7EC4;<code>objc_tag_ext_classes</code>&#x4E2D;&#x53D6;&#x6570;&#x636E;&#xFF1B;</li>
<li>&#x5F53;&#x7D22;&#x5F15;<code>tag</code>&#x65E0;&#x6548;&#x65F6;&#xFF0C;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A; <code>nil</code>&#xFF1B;</li>
</ul>
<h3 id="223&#x3001;&#x7D22;&#x5F15;objctagindext"><a name="223&#x3001;&#x7D22;&#x5F15;objctagindext" class="anchor-navigation-ex-anchor" href="#223&#x3001;&#x7D22;&#x5F15;objctagindext"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.3&#x3001;&#x7D22;&#x5F15;<code>objc_tag_index_t</code></h3>
<p><code>classSlotForBasicTagIndex()</code> &#x51FD;&#x6570;&#x4E0E;<code>classSlotForTagIndex()</code> &#x51FD;&#x6570;&#x7684;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x6570;&#x7EC4;<code>objc_tag_classes</code>&#x4E0E;&#x6570;&#x7EC4;<code>objc_tag_ext_classes</code>&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF01;
&#x90A3;&#x4E48;&#x5B83;&#x7684;&#x7D22;&#x5F15; <code>objc_tag_index_t</code> &#x662F;&#x4F55;&#x65B9;&#x795E;&#x5723;&#x5462;&#xFF1F;</p>
<p>&#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684; <code>objc-internal.h</code>&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230;&#x4E86; <code>objc_tag_index_t</code>&#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<pre><code>//&#x6709;&#x5173;&#x4E8E;&#x6807;&#x5FD7;&#x4F4D;&#x7684;&#x679A;&#x4E3E;&#x5982;&#x4E0B;&#xFF1A;
#if __has_feature(objc_fixed_enum)  ||  __cplusplus &gt;= 201103L
enum objc_tag_index_t : uint16_t
#else
typedef uint16_t objc_tag_index_t;//&#x65E0;&#x7B26;&#x53F7;&#x77ED;&#x6574;&#x578B;
enum
#endif
{
    // 60&#x4F4D;&#x51C0;&#x8D1F;&#x8377;
    OBJC_TAG_NSAtom            = 0, 
    OBJC_TAG_1                 = 1, 
    OBJC_TAG_NSString          = 2, //&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;NSString&#x5BF9;&#x8C61;
    OBJC_TAG_NSNumber          = 3, //&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;NSNumber&#x5BF9;&#x8C61;
    OBJC_TAG_NSIndexPath       = 4, //&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;NSIndexPath&#x5BF9;&#x8C61;
    OBJC_TAG_NSManagedObjectID = 5, 
    OBJC_TAG_NSDate            = 6,//&#x8868;&#x793A;&#x8FD9;&#x662F;&#x4E00;&#x4E2A;NSDate&#x5BF9;&#x8C61;

    OBJC_TAG_RESERVED_7        = 7, //60&#x4F4D;&#x51C0;&#x8D1F;&#x8377;&#xFF1A; &#x7D22;&#x5F15; 7 &#x88AB;&#x4FDD;&#x7559;

    // 52 &#x4F4D;&#x51C0;&#x8D1F;&#x8377;
    OBJC_TAG_Photos_1          = 8,
    OBJC_TAG_Photos_2          = 9,
    OBJC_TAG_Photos_3          = 10,
    OBJC_TAG_Photos_4          = 11,
    OBJC_TAG_XPC_1             = 12,
    OBJC_TAG_XPC_2             = 13,
    OBJC_TAG_XPC_3             = 14,
    OBJC_TAG_XPC_4             = 15,

    OBJC_TAG_First60BitPayload = 0, 
    OBJC_TAG_Last60BitPayload  = 6, 
    OBJC_TAG_First52BitPayload = 8, // 52 &#x4F4D;&#x51C0;&#x8D1F;&#x8377;&#x7684;&#x5F00;&#x59CB;&#x5904;
    OBJC_TAG_Last52BitPayload  = 263, // 52 &#x4F4D;&#x51C0;&#x8D1F;&#x8377;&#x7684;&#x7ED3;&#x675F;&#x5904;

    OBJC_TAG_RESERVED_264      = 264 // 52 &#x4F4D;&#x51C0;&#x8D1F;&#x8377;&#xFF1A; &#x7D22;&#x5F15; 264 &#x88AB;&#x4FDD;&#x7559;
};
#if __has_feature(objc_fixed_enum)  &amp;&amp;  !defined(__cplusplus)
typedef enum objc_tag_index_t objc_tag_index_t;
#endif
</code></pre><p><code>objc_tag_index_t</code> &#x5C31;&#x662F;&#x4E2A;&#x679A;&#x4E3E;&#x53D8;&#x91CF;&#xFF0C;&#x5B58;&#x50A8;&#x5728; <code>Tagged Pointer</code> &#x7684;&#x7279;&#x6B8A;&#x6807;&#x8BB0;&#x7684;&#x90E8;&#x4F4D;&#xFF01;</p>
<blockquote>
<p><a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime</a>  &#x5C31;&#x662F;&#x6839;&#x636E; <code>objc_tag_index_t</code>&#x7684;&#x679A;&#x4E3E;&#x503C;&#x5224;&#x65AD;<code>Tagged Pointer</code> &#x5B58;&#x50A8;&#x7684;&#x662F; <code>NSString</code>&#x5BF9;&#x8C61;&#x6216;&#x8005; <code>NSNumber</code>&#x5BF9;&#x8C61;...</p>
</blockquote>
<h3 id="224&#x3001;objcregistertaggedpointerclass-&#x51FD;&#x6570;"><a name="224&#x3001;objcregistertaggedpointerclass-&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#224&#x3001;objcregistertaggedpointerclass-&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.4&#x3001;<code>_objc_registerTaggedPointerClass()</code> &#x51FD;&#x6570;</h3>
<p>&#x73B0;&#x5728;&#x77E5;&#x9053;&#x4E86;<code>classSlotForBasicTagIndex()</code> &#x51FD;&#x6570;&#x4E0E;<code>classSlotForTagIndex()</code> &#x51FD;&#x6570;&#x7684;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x83B7;&#x53D6;&#x6570;&#x7EC4;<code>objc_tag_classes</code>&#x4E0E;&#x6570;&#x7EC4;<code>objc_tag_ext_classes</code>&#x4E2D;&#x7684;&#x6570;&#x636E;&#xFF01;&#x800C;&#x7D22;&#x5F15; <code>objc_tag_index_t</code>  &#x53C8;&#x7528;&#x6765;&#x5728;<code>Tagged Pointer</code> &#x5BF9;&#x8C61;&#x6807;&#x8BB0;&#x5B58;&#x50A8;&#x7684;&#x7C7B;&#xFF01;</p>
<p>&#x51C6;&#x5907;&#x5DE5;&#x4F5C;&#x5DF2;&#x7ECF;&#x505A;&#x8DB3;&#xFF0C;&#x73B0;&#x5728;&#x53BB;&#x5206;&#x6790;<code>_objc_registerTaggedPointerClass()</code>&#x51FD;&#x6570;&#xFF01; &#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684; <code>objc-runtime-new.mm</code>&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code>void _objc_registerTaggedPointerClass(objc_tag_index_t tag, Class cls){
    if (objc_debug_taggedpointer_mask == 0) {
        _objc_fatal(&quot;tagged pointers are disabled&quot;);
    }

    Class *slot = classSlotForTagIndex(tag);//&#x6839;&#x636E;&#x7D22;&#x5F15;&#x83B7;&#x53D6;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x6307;&#x9488;
    if (!slot) {
        _objc_fatal(&quot;tag index %u is invalid&quot;, (unsigned int)tag);
    }

    Class oldCls = *slot;//&#x53D6;&#x51FA;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;&#x7C7B;
    if (cls  &amp;&amp;  oldCls  &amp;&amp;  cls != oldCls) {
        //&#x6307;&#x5B9A;&#x7684;&#x7D22;&#x5F15;&#x88AB;&#x7528;&#x4E8E;&#x4E24;&#x4E2A;&#x4E0D;&#x540C;&#x7684;&#x7C7B;&#xFF0C;&#x7EC8;&#x6B62;&#x7A0B;&#x5E8F;
        _objc_fatal(&quot;tag index %u used for two different classes (was %p %s, now %p %s)&quot;, tag,oldCls, oldCls-&gt;nameForLogging(),cls, cls-&gt;nameForLogging());
    }
    *slot = cls;//&#x5C06;&#x5165;&#x53C2; cls &#x8D4B;&#x503C;&#x7ED9;&#x8BE5;&#x7C7B;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;&#x5730;&#x5740;

    if (tag &lt; OBJC_TAG_First60BitPayload || tag &gt; OBJC_TAG_Last60BitPayload) {
        Class *extSlot = classSlotForBasicTagIndex(OBJC_TAG_RESERVED_7);
        if (*extSlot == nil) {
            extern objc_class OBJC_CLASS_$___NSUnrecognizedTaggedPointer;
            *extSlot = (Class)&amp;OBJC_CLASS_$___NSUnrecognizedTaggedPointer;//&#x8868;&#x793A; TaggedPointer &#x7C7B;
        }
    }
}
</code></pre><p>&#x5206;&#x6790;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<ul>
<li>1&#x3001;&#x9996;&#x5148;&#x5224;&#x65AD; <code>objc_debug_taggedpointer_mask</code>&#x662F;&#x5426;&#x4E3A; 0 &#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5224;&#x65AD;&#x5F00;&#x53D1;&#x8005;&#x662F;&#x5426;&#x628A; <code>OBJC_DISABLE_TAGGED_POINTERS</code> &#x8BBE;&#x7F6E;&#x4E3A; <code>YES</code>&#xFF1B;&#x5982;&#x679C;&#x7981;&#x7528;&#x4E86; <code>Tagged Pointer</code> &#xFF0C;&#x90A3;&#x4E48;&#x4E0D;&#x597D;&#x610F;&#x601D;&#xFF0C;&#x76F4;&#x63A5;&#x8C03;&#x7528; <code>_objc_fatal()</code>&#x51FD;&#x6570;&#x7EC8;&#x6B62;&#x8BE5;&#x7A0B;&#x5E8F;&#xFF0C;&#x4E0D;&#x8BA9;&#x8BE5;&#x7A0B;&#x5E8F;&#x542F;&#x52A8;&#xFF01;
&#x53EA;&#x6709;&#x542F;&#x7528; <code>Tagged Pointer</code> &#xFF0C;&#x7A0B;&#x5E8F;&#x624D;&#x6709;&#x6267;&#x884C;&#x4E0B;&#x53BB;&#x7684;&#x610F;&#x4E49;&#xFF01;</li>
<li>2&#x3001;&#x6839;&#x636E;&#x7D22;&#x5F15; <code>tag</code>&#x53BB;&#x53D6;&#x51FA;&#x6570;&#x7EC4;<code>objc_tag_classes</code>&#x6216;&#x6570;&#x7EC4;<code>objc_tag_ext_classes</code>&#x4E2D;&#x6307;&#x5B9A;&#x7684;&#x7C7B;&#x6307;&#x9488;<code>classSlotForTagIndex(tag)</code>&#xFF1A;
&#x5982;&#x679C;&#x4F20;&#x9012;&#x65E0;&#x6548;&#x7684;&#x7D22;&#x5F15; <code>tag</code>&#xFF0C;&#x83B7;&#x53D6;&#x4E00;&#x4E2A; <code>nil</code>&#xFF0C;&#x8FD8;&#x662F;&#x8981;&#x8C03;&#x7528;<code>_objc_fatal()</code>&#x7EC8;&#x6B62;&#x8BE5;&#x7A0B;&#x5E8F;&#xFF1B;</li>
<li>3&#x3001;&#x5C1D;&#x8BD5;&#x7740;&#x53BB;&#x83B7;&#x53D6;&#x8BE5;&#x6307;&#x9488;&#x6307;&#x5411;&#x7684;&#x7C7B;<code>Class oldCls = *slot</code>&#xFF1A;&#x5982;&#x679C;&#x8981;&#x6CE8;&#x518C;&#x7684;&#x7C7B;&#x548C;&#x8BE5;&#x5904;&#x7684;&#x7C7B;&#x4E0D;&#x662F;&#x540C;&#x4E00;&#x4E2A;&#xFF1F;&#x4E0D;&#x597D;&#x610F;&#x601D;&#xFF0C;<code>_objc_fatal()</code>&#x7EC8;&#x6B62;&#x7A0B;&#x5E8F;&#xFF01;
&#x53EA;&#x6709;&#x7C7B;&#x6307;&#x9488; <code>slot</code>&#x6307;&#x5411;&#x7684;&#x4F4D;&#x7F6E;&#x4E3A; <code>NULL</code>&#xFF0C;&#x6216;&#x8005;&#x7C7B;&#x6307;&#x9488; <code>slot</code>&#x6307;&#x5411;&#x7684;&#x4F4D;&#x7F6E;&#x5C31;&#x662F;&#x5B58;&#x50A8;&#x7740;&#x6211;&#x4EEC;&#x8981;&#x6CE8;&#x518C;&#x7684;&#x7C7B;&#xFF0C;&#x7CFB;&#x7EDF;&#x624D;&#x80FD;&#x5B89;&#x7A33;&#x7684;&#x8FD0;&#x884C;&#x4E0B;&#x53BB;&#xFF1B;</li>
<li>4&#x3001;&#x5C06;&#x5165;&#x53C2;<code>cls</code>&#x8D4B;&#x503C;&#x7ED9;&#x7C7B;&#x6307;&#x9488; <code>slot</code>&#x6307;&#x5411;&#x7684;&#x4F4D;&#x7F6E;<code>*slot = cls</code>&#xFF1B;&#x5230;&#x6B64;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x529F;&#x80FD;&#x7ECF;&#x8FC7;&#x91CD;&#x91CD;&#x8003;&#x9A8C;&#x5C31;&#x5DF2;&#x7ECF;&#x5B9E;&#x73B0;&#x4E86;&#xFF01;</li>
<li>5&#x3001;&#x5047;&#x5982;&#x6CE8;&#x518C;&#x7684;&#x4E0D;&#x662F;&#x57FA;&#x7840;&#x7C7B;&#xFF0C;&#x800C;&#x662F;&#x7B2C;&#x4E00;&#x6B21;&#x6CE8;&#x518C;&#x6269;&#x5C55;&#x7C7B;&#xFF0C;&#x8BE5;&#x51FD;&#x6570;&#x8FD8;&#x6709;&#x4E2A;&#x989D;&#x5916;&#x529F;&#x80FD;&#xFF1A;&#x5728;<code>OBJC_TAG_RESERVED_7</code>&#x51FA;&#x5B58;&#x50A8;&#x5360;&#x4F4D;&#x7C7B; <code>OBJC_CLASS_$___NSUnrecognizedTaggedPointer</code></li>
</ul>
<h3 id="225&#x3001;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;tagged-pointer"><a name="225&#x3001;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;tagged-pointer" class="anchor-navigation-ex-anchor" href="#225&#x3001;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;tagged-pointer"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.5&#x3001;&#x6253;&#x5370;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;<code>Tagged Pointer</code></h3>
<p>&#x4E0D;&#x59A8;&#x5728;<code>_objc_registerTaggedPointerClass()</code>&#x51FD;&#x6570;&#x4E2D;&#x63D2;&#x5165;&#x4E00;&#x6761; <code>print()</code>&#x8BED;&#x53E5;&#xFF0C;&#x6253;&#x5370;&#x51FA;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;<code>Tagged Pointer</code> &#xFF0C;&#x5982;&#x4E0B;&#x56FE;&#x6240;&#x793A;&#xFF1A;</p>
<p><img src="assets/_objc_registerTaggedPointerClass2.png" alt="&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#x7684;Tagged Pointer"></p>
<p>&#x89C2;&#x5BDF;&#x6253;&#x5370;&#x65E5;&#x5FD7;&#xFF0C;&#x53EF;&#x4EE5;&#x5F97;&#x77E5;<code>NSNumber</code>&#x3001;<code>NSString</code>&#x7B49;&#x786E;&#x5B9E;&#x5728;&#x542F;&#x52A8;&#x7A0B;&#x5E8F;&#x65F6;&#xFF0C;&#x88AB;&#x7CFB;&#x7EDF;&#x6CE8;&#x518C;&#xFF01;</p>
<h3 id="226&#x3001;&#x83B7;&#x53D6;objcregistertaggedpointerclass&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;"><a name="226&#x3001;&#x83B7;&#x53D6;objcregistertaggedpointerclass&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;" class="anchor-navigation-ex-anchor" href="#226&#x3001;&#x83B7;&#x53D6;objcregistertaggedpointerclass&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;"><i class="fa fa-link" aria-hidden="true"></i></a>2.2.6&#x3001;&#x83B7;&#x53D6;<code>_objc_registerTaggedPointerClass()</code>&#x51FD;&#x6570;&#x8C03;&#x7528;&#x6808;</h3>
<p>&#x5728;<code>_objc_registerTaggedPointerClass()</code>&#x51FD;&#x6570;&#x6253;&#x4E00;&#x4E2A;&#x65AD;&#x70B9;&#xFF0C;&#x6253;&#x5370;&#x8BE5;&#x7EBF;&#x7A0B;&#x6808;&#x4FE1;&#x606F;&#xFF1A;</p>
<pre><code>(lldb)  thread backtrace
* thread #1, queue = &apos;com.apple.main-thread&apos;, stop reason = breakpoint 1.1
  * frame #0: 0x0000000100382213 libobjc.A.dylib`::_objc_registerTaggedPointerClass(tag=OBJC_TAG_NSNumber, cls=__NSCFNumber) at objc-runtime-new.mm:6668
    frame #1: 0x00007fff433a0b5b CoreFoundation`__CFNumberGetTypeID_block_invoke + 65
    frame #2: 0x0000000100d087c3 libdispatch.dylib`_dispatch_client_callout + 8
    frame #3: 0x0000000100d0a48b libdispatch.dylib`_dispatch_once_callout + 87
    frame #4: 0x00007fff433a0b17 CoreFoundation`CFNumberGetTypeID + 39
    frame #5: 0x00007fff433a0103 CoreFoundation`__CFInitialize + 715
    frame #6: 0x0000000100020a68 dyld`ImageLoaderMachO::doImageInit(ImageLoader::LinkContext const&amp;) + 316
    frame #7: 0x0000000100020ebb dyld`ImageLoaderMachO::doInitialization(ImageLoader::LinkContext const&amp;) + 29
    frame #8: 0x000000010001c0da dyld`ImageLoader::recursiveInitialization(ImageLoader::LinkContext const&amp;, unsigned int, char const*, ImageLoader::InitializerTimingList&amp;, ImageLoader::UninitedUpwards&amp;) + 358
    frame #9: 0x000000010001c06d dyld`ImageLoader::recursiveInitialization(ImageLoader::LinkContext const&amp;, unsigned int, char const*, ImageLoader::InitializerTimingList&amp;, ImageLoader::UninitedUpwards&amp;) + 249
    frame #10: 0x000000010001c06d dyld`ImageLoader::recursiveInitialization(ImageLoader::LinkContext const&amp;, unsigned int, char const*, ImageLoader::InitializerTimingList&amp;, ImageLoader::UninitedUpwards&amp;) + 249
    frame #11: 0x000000010001c06d dyld`ImageLoader::recursiveInitialization(ImageLoader::LinkContext const&amp;, unsigned int, char const*, ImageLoader::InitializerTimingList&amp;, ImageLoader::UninitedUpwards&amp;) + 249
    frame #12: 0x000000010001b254 dyld`ImageLoader::processInitializers(ImageLoader::LinkContext const&amp;, unsigned int, ImageLoader::InitializerTimingList&amp;, ImageLoader::UninitedUpwards&amp;) + 134
    frame #13: 0x000000010001b2e8 dyld`ImageLoader::runInitializers(ImageLoader::LinkContext const&amp;, ImageLoader::InitializerTimingList&amp;) + 74
    frame #14: 0x000000010000a756 dyld`dyld::initializeMainExecutable() + 169
    frame #15: 0x000000010000f78f dyld`dyld::_main(macho_header const*, unsigned long, int, char const**, char const**, char const**, unsigned long*) + 6237
    frame #16: 0x00000001000094f6 dyld`dyldbootstrap::start(macho_header const*, int, char const**, long, macho_header const*, unsigned long*) + 1154
    frame #17: 0x0000000100009036 dyld`_dyld_start + 54
</code></pre><p>&#x5177;&#x4F53;&#x7684;&#x8C03;&#x7528;&#x4FE1;&#x606F;&#x5982;&#x4E0A;&#x6240;&#x793A;&#xFF0C;&#x8FD9;&#x91CC;&#x4E0D;&#x518D;&#x8FC7;&#x591A;&#x5570;&#x55E6;&#xFF01;</p>
<p>&#x81F3;&#x6B64;&#xFF0C;&#x7B14;&#x8005;&#x5DF2;&#x7ECF;&#x8BB2;&#x5B8C;&#x4E86;&#x6CE8;&#x518C;&#x4E3A;<code>Tagged Pointer</code> &#x7684;&#x6D41;&#x7A0B;&#xFF01;</p>
<h2 id="23&#x3001;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x662F;&#x5426;&#x662F;-tagged-pointer"><a name="23&#x3001;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x662F;&#x5426;&#x662F;-tagged-pointer" class="anchor-navigation-ex-anchor" href="#23&#x3001;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x662F;&#x5426;&#x662F;-tagged-pointer"><i class="fa fa-link" aria-hidden="true"></i></a>2.3&#x3001;&#x5224;&#x65AD;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x662F;&#x5426;&#x662F; <code>Tagged Pointer</code></h2>
<p><code>Tagged Pointer</code> &#x4E4B;&#x6240;&#x4EE5;&#x7279;&#x6B8A;&#xFF0C;&#x662F;&#x56E0;&#x4E3A;&#x5B83;&#x6709;&#x4E2A;&#x6807;&#x8BB0;&#x4F4D;&#x8868;&#x660E;&#x5B83;&#x662F;&#x7279;&#x6B8A;&#x6307;&#x9488;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x5982;&#x4F55;&#x5224;&#x65AD;&#x8FD9;&#x4E2A;&#x7279;&#x6B8A;&#x7684;&#x6807;&#x8BB0;&#x5462;&#xFF1F;</p>
<p>&#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684; <code>objc-internal.h</code>&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230;&#x4E86; <code>_objc_isTaggedPointer()</code>&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code>static inline bool _objc_isTaggedPointer(const void * _Nullable ptr){
    //&#x5C06;&#x4E00;&#x4E2A;&#x6307;&#x9488;&#x5730;&#x5740;&#x548C; _OBJC_TAG_MASK &#x5E38;&#x91CF;&#x505A; &amp; &#x8FD0;&#x7B97;&#xFF1A;&#x5224;&#x65AD;&#x8BE5;&#x6307;&#x9488;&#x7684;&#x6700;&#x9AD8;&#x4F4D;&#x6216;&#x8005;&#x6700;&#x4F4E;&#x4F4D;&#x4E3A; 1&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x6307;&#x9488;&#x5C31;&#x662F; Tagged Pointer&#x3002;
    return ((uintptr_t)ptr &amp; _OBJC_TAG_MASK) == _OBJC_TAG_MASK;
}
</code></pre><p>&#x8BE5;&#x51FD;&#x6570;&#x5C06; &#x6307;&#x9488;<code>ptr</code> &#x4E0E; <code>_OBJC_TAG_MASK</code> &#x505A;&#x4E86;<em>&#x6309;&#x4F4D;&#x4E0E;</em> &#x8FD0;&#x7B97;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FD0;&#x7B97;&#x6709;&#x4EC0;&#x4E48;&#x610F;&#x4E49;&#x5462;&#xFF1F;&#x6211;&#x4EEC;&#x5148;&#x770B;&#x4E0B;<code>_OBJC_TAG_MASK</code> &#x7684;&#x5B9A;&#x4E49;&#xFF1A;</p>
<pre><code>#if OBJC_MSB_TAGGED_POINTERS //MSB &#x9AD8;&#x4F4D;&#x4F18;&#x5148;
#   define _OBJC_TAG_MASK (1UL&lt;&lt;63) //Tagged Pointer &#x6307;&#x9488;
#else //LSB &#x4F4E;&#x4F4D;&#x4F18;&#x5148;
#   define _OBJC_TAG_MASK 1UL //Tagged Pointer &#x6307;&#x9488;
#endif
</code></pre><p>&#x5BF9;&#x4E8E; iOS &#x7CFB;&#x7EDF;&#x800C;&#x8A00;&#xFF0C;&#x9075;&#x5FAA; MSB &#x89C4;&#x5219;&#xFF08;&#x9AD8;&#x4F4D;&#x4F18;&#x5148;&#xFF09;&#xFF01;&#x56E0;&#x6B64;<code>_OBJC_TAG_MASK</code>&#x7684;&#x503C;&#x4E3A; <code>0x8000000000000000</code>&#xFF1A;&#x4E00;&#x4E2A;64 &#x4F4D;&#x7684;&#x4E8C;&#x8FDB;&#x5236;&#xFF0C;&#x6700;&#x5DE6;&#x8FB9;&#x4E00;&#x4F4D;&#x662F; 1&#xFF0C;&#x5176;&#x4F59;&#x4F4D;&#x5168;&#x662F; 0&#xFF01;</p>
<blockquote>
<p>&#x5728; 64 &#x4F4D;&#x7CFB;&#x7EDF;&#x4E2D;&#xFF0C;&#x4F7F;&#x7528;&#x6307;&#x9488;&#x5F88;&#x96BE;&#x5C06;&#x6709;&#x9650;&#x7684; CPU &#x8D44;&#x6E90;&#x8017;&#x5C3D;&#xFF1B;&#x56E0;&#x6B64; 64 &#x4F4D;&#x8FD8;&#x6709;&#x5F88;&#x5927;&#x7684;&#x5269;&#x4F59;&#xFF01; &#x82F9;&#x679C;&#x5C06;64&#x4E2D;&#x7684;&#x6700;&#x5DE6;&#x8FB9;&#x4E00;&#x4F4D;&#xFF08;MSB &#x65F6;&#xFF09;&#x6807;&#x8BB0;&#x662F; 1 &#xFF0C;&#x6216;&#x8005;&#x6700;&#x53F3;&#x8FB9;&#x4E00;&#x4F4D;&#xFF08;LSB &#x65F6;&#xFF09;&#x6807;&#x8BB0;&#x662F; 1 &#xFF0C;&#x4EE5;&#x6B64;&#x6765;&#x8868;&#x793A;&#x8FD9;&#x4E2A;&#x6307;&#x9488;&#x662F;   <code>Tagged Pointer</code>  &#x3002;</p>
</blockquote>
<p>&#x56E0;&#x6B64; <code>ptr &amp; _OBJC_TAG_MASK)</code> &#x6309;&#x4F4D;&#x4E0E; &#x8FD0;&#x7B97;&#x540E;&#x53EF;&#x4EE5;&#x5224;&#x65AD;&#x5B83;&#x7684;&#x6807;&#x5FD7;&#x4F4D;&#x662F;&#x5426;&#x662F; 1&#xFF0C;&#x5373;&#x662F;&#x5426;&#x662F; <code>Tagged Pointer</code>  &#xFF01;</p>
<h2 id="24&#x3001;&#x5728;&#x4F2A;&#x6307;&#x9488;-tagged-pointer-&#x5B58;&#x50A8;&#x6570;&#x636E;"><a name="24&#x3001;&#x5728;&#x4F2A;&#x6307;&#x9488;-tagged-pointer-&#x5B58;&#x50A8;&#x6570;&#x636E;" class="anchor-navigation-ex-anchor" href="#24&#x3001;&#x5728;&#x4F2A;&#x6307;&#x9488;-tagged-pointer-&#x5B58;&#x50A8;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.4&#x3001;&#x5728;&#x4F2A;&#x6307;&#x9488; <code>Tagged Pointer</code> &#x5B58;&#x50A8;&#x6570;&#x636E;</h2>
<p>&#x8BB2;&#x4E86;&#x534A;&#x5929;&#xFF1A;&#x53C8;&#x662F;&#x7981;&#x7528; <code>Tagged Pointer</code> &#x3001;&#x53C8;&#x662F;&#x6CE8;&#x518C; <code>Tagged Pointer</code> &#x3001;&#x53C8;&#x662F;&#x5224;&#x65AD; <code>Tagged Pointer</code>  &#x7684; &#xFF01; &#x90A3;&#x4E48;&#x5230;&#x5E95;&#x600E;&#x4E48;&#x5B58;&#x50A8;<code>NSNumber</code>&#x3001;<code>NSDate</code>&#x3001;<code>NSString</code>&#x7B49;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;&#x5462;&#xFF1F;</p>
<p>&#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684; <code>objc-internal.h</code>&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230;&#x4E86; <code>_objc_makeTaggedPointer()</code> &#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code>static inline void * _Nonnull _objc_makeTaggedPointer(objc_tag_index_t tag, uintptr_t value){
    if (tag &lt;= OBJC_TAG_Last60BitPayload) {//&#x5982;&#x679C;&#x662F;&#x57FA;&#x7840;&#x7684;&#x7D22;&#x5F15;
        uintptr_t result = (_OBJC_TAG_MASK | ((uintptr_t)tag &lt;&lt; _OBJC_TAG_INDEX_SHIFT) |  ((value &lt;&lt; _OBJC_TAG_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_LSHIFT));
        return _objc_encodeTaggedPointer(result);
    } else {//&#x5982;&#x679C;&#x662F;&#x6269;&#x5C55;&#x7684;&#x7D22;&#x5F15;
        uintptr_t result =  (_OBJC_TAG_EXT_MASK |  ((uintptr_t)(tag - OBJC_TAG_First52BitPayload) &lt;&lt; _OBJC_TAG_EXT_INDEX_SHIFT) | ((value &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT));
        return _objc_encodeTaggedPointer(result);
    }
}
</code></pre><p>&#x8BE5;&#x51FD;&#x6570;&#x5C06; <code>value</code> &#x4F4D;&#x8FD0;&#x7B97;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x7F16;&#x7801; <code>_objc_encodeTaggedPointer()</code>&#xFF0C;&#x5C31;&#x662F;&#x6307;&#x9488;&#x7684;&#x503C;&#xFF01;</p>
<h6 id="a&#x3001;&#x5C1D;&#x8BD5;&#x8BA1;&#x7B97;"><a name="a&#x3001;&#x5C1D;&#x8BD5;&#x8BA1;&#x7B97;" class="anchor-navigation-ex-anchor" href="#a&#x3001;&#x5C1D;&#x8BD5;&#x8BA1;&#x7B97;"><i class="fa fa-link" aria-hidden="true"></i></a>a&#x3001;&#x5C1D;&#x8BD5;&#x8BA1;&#x7B97;</h6>
<pre><code>#if OBJC_MSB_TAGGED_POINTERS //MSB &#x9AD8;&#x4F4D;&#x4F18;&#x5148;
#   define _OBJC_TAG_MASK (1UL&lt;&lt;63) //Tagged Pointer &#x6307;&#x9488;
#   define _OBJC_TAG_INDEX_SHIFT 60
#   define _OBJC_TAG_SLOT_SHIFT 60
#   define _OBJC_TAG_PAYLOAD_LSHIFT 4
#   define _OBJC_TAG_PAYLOAD_RSHIFT 4
#   define _OBJC_TAG_EXT_MASK (0xfUL&lt;&lt;60)
#   define _OBJC_TAG_EXT_INDEX_SHIFT 52
#   define _OBJC_TAG_EXT_SLOT_SHIFT 52
#   define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 12
#   define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12
#else //LSB &#x4F4E;&#x4F4D;&#x4F18;&#x5148;
#   define _OBJC_TAG_MASK 1UL //Tagged Pointer &#x6307;&#x9488;
#   define _OBJC_TAG_INDEX_SHIFT 1
#   define _OBJC_TAG_SLOT_SHIFT 0
#   define _OBJC_TAG_PAYLOAD_LSHIFT 0
#   define _OBJC_TAG_PAYLOAD_RSHIFT 4
#   define _OBJC_TAG_EXT_MASK 0xfUL
#   define _OBJC_TAG_EXT_INDEX_SHIFT 4
#   define _OBJC_TAG_EXT_SLOT_SHIFT 4
#   define _OBJC_TAG_EXT_PAYLOAD_LSHIFT 0
#   define _OBJC_TAG_EXT_PAYLOAD_RSHIFT 12
#endif
</code></pre><p>&#x6211;&#x4EEC;&#x4EE5; 1.4 &#x8282; &#x4E2D;&#x7684;<code>NSNumber</code>&#x4E3A;&#x4F8B;&#x5C1D;&#x8BD5;&#x8BA1;&#x7B97;&#x4E00;&#x4E0B;&#xFF1A;&#x5F53;&#x5B58;&#x50A8;&#x6574;&#x6570;0 &#x65F6;<code>Tagged Pointer</code> &#x7684;&#x503C;&#x4E3A;<code>0xb000000000000002</code>&#xFF01;&#xFF08;&#x4EE5;MSB &#x89C4;&#x5219;&#x8BA1;&#x7B97;&#xFF09;</p>
<p>&#x7531;&#x4E8E;<code>NSNumber</code>&#x4E3A;&#x57FA;&#x7840;&#x7C7B;&#xFF0C;&#x5B83;&#x7684;&#x7D22;&#x5F15;&#x4E3A; <code>OBJC_TAG_NSNumber=3</code>&#xFF0C;&#x6240;&#x4EE5; <code>tag &lt;= OBJC_TAG_Last60BitPayload</code>&#xFF1A;</p>
<ul>
<li>1&#x3001;<code>_OBJC_TAG_MASK</code>  &#x53D6;&#x503C; <code>0x8000000000000000</code> &#xFF1B;</li>
<li>2&#x3001;<code>tag &lt;&lt; _OBJC_TAG_INDEX_SHIFT</code> &#x8F6C;&#x4E3A;<code>0x3 &lt;&lt; 60</code>&#xFF0C;&#x4F4D;&#x8FD0;&#x7B97;&#x7ED3;&#x679C;&#x662F; <code>0x3000000000000000</code>&#xFF1B;&#x8BE5;&#x8FD0;&#x7B97;&#x7684;&#x76EE;&#x7684;&#x662F;&#x5C06;&#x7C7B;&#x7684;&#x6807;&#x8BC6;&#x7B26;&#x5B58;&#x50A8;&#x5728;&#x6807;&#x5FD7;&#x4F4D;&#x91CC;&#xFF1B;</li>
<li>3&#x3001;<code>_OBJC_TAG_MASK | ((uintptr_t)tag &lt;&lt; _OBJC_TAG_INDEX_SHIFT)</code> &#x8F6C;&#x4E3A; <code>0x8000000000000000 | 0x3000000000000000</code> &#xFF0C;&#x4F4D;&#x8FD0;&#x7B97;&#x7ED3;&#x679C;&#x662F;<code>0xb000000000000000</code>&#xFF1B;&#x8BE5;&#x7ED3;&#x679C;&#x5C31;&#x662F;<code>Tagged Pointer</code> &#x7684;&#x6807;&#x8BB0;&#xFF1B;</li>
<li>4&#x3001;<code>(value &lt;&lt; _OBJC_TAG_PAYLOAD_RSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_LSHIFT)</code>&#xFF1A;</li>
<li>5&#x3001;&#x5148;&#x6765;&#x8BF4;&#x8BF4;<code>(value &lt;&lt; _OBJC_TAG_PAYLOAD_RSHIFT)</code>&#xFF0C;&#x5C06;<code>value</code>&#x5DE6;&#x79FB; 4 &#x4F4D;&#xFF0C;&#x4E3A;&#x4F55;&#x662F; 4 &#x4F4D;&#xFF1F;&#x56E0;&#x4E3A;&#x6709; 4 &#x4F4D;&#x6807;&#x8BC6;&#x7B26;&#xFF0C;&#x6700;&#x53F3;&#x8FB9;&#x4E00;&#x4F4D;&#x7684;<code>1</code>&#x662F;<code>Tagged Pointer</code> &#x7684;&#x6807;&#x5FD7;&#xFF0C;&#x5269;&#x4F59;&#x4E09;&#x4F4D;&#x662F;&#x5B58;&#x50A8;&#x7C7B;&#x7684;&#x8BC6;&#x522B;&#xFF01;</li>
<li>6&#x3001;&#x518D;&#x6765;&#x8BF4;&#x8BF4;<code>&gt;&gt; _OBJC_TAG_PAYLOAD_LSHIFT)</code>&#xFF0C;&#x5C06;&#x7B2C; 5 &#x6B65;&#x7684;&#x4F4D;&#x8FD0;&#x7B97;&#x7ED3;&#x679C;&#x53F3;&#x79FB; <code>_OBJC_TAG_PAYLOAD_LSHIFT</code>
&#x9075;&#x5FAA; MSB &#x65F6;&#x53F3;&#x79FB; 4 &#x4F4D;&#xFF0C;&#x56E0;&#x4E3A;4 &#x4F4D;&#x6807;&#x8BC6;&#x7B26;&#x5728;&#x6700;&#x5DE6;&#x8FB9;&#xFF0C;&#x5373;&#x6700;&#x5DE6;&#x8FB9; 4 &#x4F4D;&#x4E0D;&#x80FD;&#x7528;&#x6765;&#x8868;&#x793A;&#x503C;&#xFF01;
&#x9075;&#x5FAA; LSB &#x65F6;&#x53F3;&#x79FB; 0 &#x4F4D;&#xFF0C;&#x56E0;&#x4E3A;4 &#x4F4D;&#x6807;&#x8BC6;&#x7B26;&#x5728;&#x6700;&#x53F3;&#x8FB9;&#xFF0C;&#x5373;&#x6700;&#x53F3;&#x8FB9; 4 &#x4F4D;&#x4E0D;&#x80FD;&#x7528;&#x6765;&#x8868;&#x793A;&#x503C;&#xFF01;</li>
<li>7&#x3001;&#x7B2C;4&#x6B65;&#x516C;&#x5F0F;&#x8F6C;&#x4E3A;<code>(0&lt;&lt;4)&gt;&gt;0</code>&#x8BA1;&#x7B97;&#x7ED3;&#x679C;&#x662F;&#xFF1A;<code>0</code></li>
<li>8&#x3001;&#x6700;&#x7EC8; <code>result</code>&#x7ED3;&#x679C;&#x662F; <code>0xb000000000000000</code>&#xFF01;&#xFF01;</li>
</ul>
<p>&#x7591;&#x95EE;&#xFF1A;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x7684;&#x662F; <code>0xb000000000000002</code>&#xFF0C;&#x4F46;&#x4E3A;&#x4F55;&#x8BA1;&#x7B97;&#x7684;&#x662F;<code>0xb000000000000000</code>&#xFF1F;&#x8BE5;&#x5904;&#x95EE;&#x9898;&#x7B14;&#x8005;&#x6682;&#x65F6;&#x6CA1;&#x6709;&#x627E;&#x5230;&#x7B54;&#x6848;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5927;&#x795E;&#x77E5;&#x9053;&#x4E3A;&#x4F55;&#x4E0D;&#x540C;&#xFF0C;&#x600E;&#x4E48;&#x8BA1;&#x7B97;&#xFF0C;&#x8FD8;&#x671B;&#x544A;&#x77E5;&#xFF01;&#xFF01;</p>
<h6 id="b&#x3001;&#x7F16;&#x7801;&#x4E0E;&#x89E3;&#x7801;-tagged-pointer--&#x6307;&#x9488;&#x7684;&#x51FD;&#x6570;"><a name="b&#x3001;&#x7F16;&#x7801;&#x4E0E;&#x89E3;&#x7801;-tagged-pointer--&#x6307;&#x9488;&#x7684;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#b&#x3001;&#x7F16;&#x7801;&#x4E0E;&#x89E3;&#x7801;-tagged-pointer--&#x6307;&#x9488;&#x7684;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>b&#x3001;&#x7F16;&#x7801;&#x4E0E;&#x89E3;&#x7801; <code>Tagged Pointer</code>  &#x6307;&#x9488;&#x7684;&#x51FD;&#x6570;</h6>
<pre><code>/* &#x7F16;&#x7801; TaggedPointer &#x6307;&#x9488;
 */
static inline void * _Nonnull _objc_encodeTaggedPointer(uintptr_t ptr){
    return (void *)(objc_debug_taggedpointer_obfuscator ^ ptr);
}

/* &#x89E3;&#x7801; TaggedPointer &#x6307;&#x9488;
 * @param ptr &#x7F16;&#x7801;&#x540E;&#x7684; TaggedPointer &#x6307;&#x9488;
 */
static inline uintptr_t _objc_decodeTaggedPointer(const void * _Nullable ptr){
    return (uintptr_t)ptr ^ objc_debug_taggedpointer_obfuscator;
}
</code></pre><p><em>&#x6CE8;&#xFF1A;&#x6B64;&#x5904;&#x53C8;&#x51FA;&#x73B0;&#x4E86;&#x53D8;&#x91CF;<code>objc_debug_taggedpointer_obfuscator</code>&#xFF0C;&#x5728;&#x8BE5;&#x5904;&#x7684;&#x53D6;&#x503C;&#x4E3A; 0 &#xFF0C;&#x81F3;&#x4E8E;&#x4F5C;&#x7528;&#xFF0C;&#x540E;&#x6587;&#x518D;&#x8BB2;&#xFF01;</em></p>
<p>&#x901A;&#x8FC7;&#x4E00;&#x6B65;&#x6B65;&#x8BA1;&#x7B97;&#x53EF;&#x77E5;&#xFF0C;<code>Tagged Pointer</code> &#x6307;&#x9488;&#x4E0A;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x80FD;&#x591F;&#x8BA1;&#x7B97;&#x51FA;&#x6765;&#xFF0C;&#x6B64;&#x65F6;&#x6570;&#x636E;&#x66B4;&#x9732;&#x5728;&#x5916;&#xFF0C;&#x53CA;&#x5176;&#x5371;&#x9669;&#xFF01;&#x82F9;&#x679C;&#x4E3A;&#x4E86;&#x6570;&#x636E;&#x5B89;&#x5168;&#x95EE;&#x9898;&#xFF0C;&#x8BBE;&#x8BA1;&#x4E86;&#x6570;&#x636E;&#x6DF7;&#x6DC6;&#xFF01;</p>
<h2 id="25&#x3001;tagged-pointer-&#x7684;&#x6570;&#x636E;&#x6DF7;&#x6DC6;"><a name="25&#x3001;tagged-pointer-&#x7684;&#x6570;&#x636E;&#x6DF7;&#x6DC6;" class="anchor-navigation-ex-anchor" href="#25&#x3001;tagged-pointer-&#x7684;&#x6570;&#x636E;&#x6DF7;&#x6DC6;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5&#x3001;<code>Tagged Pointer</code> &#x7684;&#x6570;&#x636E;&#x6DF7;&#x6DC6;</h2>
<p>&#x5728; 2.1.2 &#x8282;&#x7684;<code>_read_images()</code>&#x51FD;&#x6570;&#x4E2D;&#x8FD8;&#x9057;&#x7559;&#x4E86; <code>initializeTaggedPointerObfuscator()</code>&#x6CA1;&#x6709;&#x8BB2;&#x89E3;&#xFF0C;&#x73B0;&#x5728;&#x6765;&#x8BF4;&#x8BF4;&#x5B83;&#x7684;&#x4F5C;&#x7528;&#x3002;
&#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684; <code>objc-runtime-new.mm</code>&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230;&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code>static void initializeTaggedPointerObfuscator(void){
    if (sdkIsOlderThan(10_14, 12_0, 12_0, 5_0, 3_0) || DisableTaggedPointerObfuscation) {
        // &#x5BF9;&#x4E8E;&#x94FE;&#x63A5;&#x5230;&#x65E7;sdk&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#xFF0C;&#x5982;&#x679C;&#x5B83;&#x4EEC;&#x4F9D;&#x8D56;&#x4E8E;tagged pointer&#x8868;&#x793A;&#xFF0C;&#x5C06;&#x6DF7;&#x6DC6;&#x5668;&#x8BBE;&#x7F6E;&#x4E3A;0&#xFF0C;
        objc_debug_taggedpointer_obfuscator = 0;
    } else {
        // &#x5C06;&#x968F;&#x673A;&#x6570;&#x636E;&#x653E;&#x5165;&#x53D8;&#x91CF;&#x4E2D;&#xFF0C;&#x7136;&#x540E;&#x79FB;&#x8D70;&#x6240;&#x6709;&#x975E;&#x51C0;&#x8D1F;&#x8377;&#x4F4D;&#x3002;
        arc4random_buf(&amp;objc_debug_taggedpointer_obfuscator,
                       sizeof(objc_debug_taggedpointer_obfuscator));
        objc_debug_taggedpointer_obfuscator &amp;= ~_OBJC_TAG_MASK;
    }
}
</code></pre><p>&#x8BE5;&#x51FD;&#x6570;&#x7684;&#x4E3B;&#x8981;&#x529F;&#x80FD;&#xFF1A;</p>
<ul>
<li>&#x5982;&#x679C;SDK&#x7248;&#x672C;&#x8FC7;&#x4F4E;&#xFF0C;&#x6216;&#x8005;&#x7981;&#x7528;&#x6DF7;&#x6DC6;&#xFF0C;&#x5219;&#x8BBE;&#x7F6E; <code>objc_debug_taggedpointer_obfuscator</code> &#x4E3A; 0&#xFF1B;</li>
<li>&#x5426;&#x5219;&#x4E3A;<code>objc_debug_taggedpointer_obfuscator</code> &#x8BBE;&#x7F6E;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x6570;&#xFF1B;</li>
</ul>
<p>&#x524D;&#x6587;&#x9057;&#x7559;&#x7684;<code>objc_debug_taggedpointer_obfuscator</code>&#x662F;&#x4EC0;&#x4E48;&#xFF0C;&#x5230;&#x6B64;&#x7EC8;&#x4E8E;&#x6709;&#x4E86;&#x660E;&#x786E;&#x7684;&#x5B9A;&#x4E49;&#xFF1A;&#x8BE5;&#x53D8;&#x91CF;&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x968F;&#x673A;&#x751F;&#x6210;&#x7684;&#x6570;&#x5B57;&#xFF0C;&#x901A;&#x8FC7;&#x7F16;&#x7801;&#x51FD;&#x6570;&#x3001;&#x6216;&#x8005;&#x89E3;&#x7801;&#x51FD;&#x6570;&#xFF0C;&#x7528;&#x6765;&#x4E0E; <code>value</code>&#x505A;&#x4F4D;&#x8FD0;&#x7B97;&#xFF0C;&#x8FD9;&#x6837;&#x63A7;&#x5236;&#x53F0;&#x5C31;&#x770B;&#x4E0D;&#x51FA;&#x662F;&#x5426;&#x662F;<code>Tagged Pointer</code>  &#x6307;&#x9488;&#xFF0C;&#x8BE5;&#x6307;&#x9488;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x4E5F;&#x662F;&#x5B89;&#x5168;&#x7684;&#xFF01;</p>
<h3 id="251&#x3001;tagged-pointer-&#x6570;&#x636E;&#x6DF7;&#x6DC6;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x542F;&#x4E0E;&#x5173;&#x95ED;"><a name="251&#x3001;tagged-pointer-&#x6570;&#x636E;&#x6DF7;&#x6DC6;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x542F;&#x4E0E;&#x5173;&#x95ED;" class="anchor-navigation-ex-anchor" href="#251&#x3001;tagged-pointer-&#x6570;&#x636E;&#x6DF7;&#x6DC6;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x542F;&#x4E0E;&#x5173;&#x95ED;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.1&#x3001;<code>Tagged Pointer</code> &#x6570;&#x636E;&#x6DF7;&#x6DC6;&#x529F;&#x80FD;&#x7684;&#x5F00;&#x542F;&#x4E0E;&#x5173;&#x95ED;</h3>
<pre><code>OPTION( DisableTaggedPointerObfuscation, OBJC_DISABLE_TAG_OBFUSCATION,    &quot;disable obfuscation of tagged pointers&quot;)
</code></pre><p>&#x901A;&#x8FC7;&#x8BBE;&#x7F6E;&#x73AF;&#x5883;&#x53D8;&#x91CF;<code>OBJC_DISABLE_TAG_OBFUSCATION</code>&#x4E3A; <code>YES</code>&#xFF0C;&#x53EF;&#x4EE5;&#x5173;&#x95ED;<code>Tagged Pointer</code> &#x7684;&#x6570;&#x636E;&#x6DF7;&#x6DC6;&#xFF0C;&#x65B9;&#x4FBF;&#x6211;&#x4EEC;&#x8C03;&#x8BD5;&#x7A0B;&#x5E8F;&#xFF01;</p>
<h3 id="252&#x3001;objcdebugtaggedpointerobfuscator&#x7684;&#x4F7F;&#x7528;"><a name="252&#x3001;objcdebugtaggedpointerobfuscator&#x7684;&#x4F7F;&#x7528;" class="anchor-navigation-ex-anchor" href="#252&#x3001;objcdebugtaggedpointerobfuscator&#x7684;&#x4F7F;&#x7528;"><i class="fa fa-link" aria-hidden="true"></i></a>2.5.2&#x3001;<code>objc_debug_taggedpointer_obfuscator</code>&#x7684;&#x4F7F;&#x7528;</h3>
<p>&#x9664;&#x4E86;&#x4E0A;&#x6587;&#x7684;&#x7F16;&#x7801;&#x89E3;&#x7801;&#x51FD;&#x6570;&#x4F7F;&#x7528;&#x4E86;<code>objc_debug_taggedpointer_obfuscator</code>&#x6765;&#x6DF7;&#x6DC6;&#x6307;&#x9488;&#xFF0C;&#x8FD8;&#x6709;&#x6700;&#x524D;&#x6587;&#x63D0;&#x5230;&#x7684;&#x901A;&#x8FC7;&#x6307;&#x5B9A;&#x7D22;&#x5F15;<code>tag</code>&#x83B7;&#x53D6;&#x7C7B;&#x6307;&#x9488;&#x65F6;&#x4F7F;&#x7528;<code>objc_debug_taggedpointer_obfuscator</code>&#x3002;</p>
<h2 id="26&#x3001;&#x83B7;&#x53D6;tagged-pointer-&#x7684;&#x6570;&#x636E;"><a name="26&#x3001;&#x83B7;&#x53D6;tagged-pointer-&#x7684;&#x6570;&#x636E;" class="anchor-navigation-ex-anchor" href="#26&#x3001;&#x83B7;&#x53D6;tagged-pointer-&#x7684;&#x6570;&#x636E;"><i class="fa fa-link" aria-hidden="true"></i></a>2.6&#x3001;&#x83B7;&#x53D6;<code>Tagged Pointer</code> &#x7684;&#x6570;&#x636E;</h2>
<p>&#x524D;&#x6587;&#x8BB2;&#x89E3;&#x4E86;&#x5982;&#x4F55;&#x5B58;&#x50A8;<code>Tagged Pointer</code> &#x7684;&#x6570;&#x636E;&#xFF0C;&#x5982;&#x4F55;&#x52A0;&#x5BC6;<code>Tagged Pointer</code> &#x7684;&#x6570;&#x636E;&#xFF01;&#x73B0;&#x5728;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x5982;&#x4F55;&#x83B7;&#x53D6;<code>Tagged Pointer</code> &#x7684;&#x6570;&#x636E;&#xFF01;</p>
<p>&#x5728; <a href="https://opensource.apple.com/tarballs/objc4/" target="_blank">Runtime &#x5E93;</a> &#x7684; <code>objc-internal.h</code>&#x6587;&#x4EF6;&#x4E2D;&#x627E;&#x5230;&#x76F8;&#x5173;&#x51FD;&#x6570;&#x7684;&#x5B9E;&#x73B0;&#xFF1A;</p>
<pre><code>/* &#x83B7;&#x53D6; Tagged Pointer &#x6307;&#x9488;&#x4E0A;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;
 * @note &#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x662F; zero-extended
 * @note &#x524D;&#x63D0;&#x6761;&#x4EF6;&#xFF1A;&#x5047;&#x8BBE;&#x542F;&#x7528;&#x4E86; tagged pointer &#x529F;&#x80FD;
 */
static inline uintptr_t _objc_getTaggedPointerValue(const void * _Nullable ptr){
    // assert(_objc_isTaggedPointer(ptr));
    uintptr_t value = _objc_decodeTaggedPointer(ptr);// &#x89E3;&#x7801; TaggedPointer &#x6307;&#x9488;
    uintptr_t basicTag = (value &gt;&gt; _OBJC_TAG_INDEX_SHIFT) &amp; _OBJC_TAG_INDEX_MASK;
    if (basicTag == _OBJC_TAG_INDEX_MASK) {
        return (value &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT;
    } else {
        return (value &lt;&lt; _OBJC_TAG_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_RSHIFT;
    }
}

/* &#x83B7;&#x53D6; Tagged Pointer &#x6307;&#x9488;&#x4E0A;&#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;
 * @note &#x5B58;&#x50A8;&#x7684;&#x6570;&#x636E;&#x662F; sign-extended
 * @note &#x524D;&#x63D0;&#x6761;&#x4EF6;&#xFF1A;&#x5047;&#x8BBE;&#x542F;&#x7528;&#x4E86; tagged pointer &#x529F;&#x80FD;
 */
static inline intptr_t _objc_getTaggedPointerSignedValue(const void * _Nullable ptr){
    // assert(_objc_isTaggedPointer(ptr));
    uintptr_t value = _objc_decodeTaggedPointer(ptr);
    uintptr_t basicTag = (value &gt;&gt; _OBJC_TAG_INDEX_SHIFT) &amp; _OBJC_TAG_INDEX_MASK;
    if (basicTag == _OBJC_TAG_INDEX_MASK) {
        return ((intptr_t)value &lt;&lt; _OBJC_TAG_EXT_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_EXT_PAYLOAD_RSHIFT;
    } else {
        return ((intptr_t)value &lt;&lt; _OBJC_TAG_PAYLOAD_LSHIFT) &gt;&gt; _OBJC_TAG_PAYLOAD_RSHIFT;
    }
}
</code></pre><h2 id="27&#x3001;tagged-pointer-&#x5176;&#x4ED6;&#x51FD;&#x6570;"><a name="27&#x3001;tagged-pointer-&#x5176;&#x4ED6;&#x51FD;&#x6570;" class="anchor-navigation-ex-anchor" href="#27&#x3001;tagged-pointer-&#x5176;&#x4ED6;&#x51FD;&#x6570;"><i class="fa fa-link" aria-hidden="true"></i></a>2.7&#x3001;<code>Tagged Pointer</code> &#x5176;&#x4ED6;&#x51FD;&#x6570;</h2>
<pre><code>/* &#x83B7;&#x53D6;&#x4E00;&#x4E2A; Tagged Pointer &#x6307;&#x9488;&#x7684;&#x7D22;&#x5F15;
 * @param ptr &#x6307;&#x5B9A;&#x7684;&#x6307;&#x9488;
 */
static inline objc_tag_index_t _objc_getTaggedPointerTag(const void * _Nullable ptr){
    // assert(_objc_isTaggedPointer(ptr));
    uintptr_t value = _objc_decodeTaggedPointer(ptr);
    uintptr_t basicTag = (value &gt;&gt; _OBJC_TAG_INDEX_SHIFT) &amp; _OBJC_TAG_INDEX_MASK;
    uintptr_t extTag =   (value &gt;&gt; _OBJC_TAG_EXT_INDEX_SHIFT) &amp; _OBJC_TAG_EXT_INDEX_MASK;
    if (basicTag == _OBJC_TAG_INDEX_MASK) {
        return (objc_tag_index_t)(extTag + OBJC_TAG_First52BitPayload);
    } else {
        return (objc_tag_index_t)basicTag;
    }
}

/* &#x6839;&#x636E;&#x6307;&#x5B9A;&#x7684;&#x7D22;&#x5F15;&#x83B7;&#x53D6; Tagged Pointer &#x8868;&#x793A;&#x7684;&#x7C7B;
 * @param tag &#x6307;&#x5B9A;&#x7684;&#x7D22;&#x5F15;
 * @return &#x5982;&#x679C;&#x8BE5;&#x7D22;&#x5F15;&#x8FD8;&#x6CA1;&#x6709;&#x4F7F;&#x7528; &#x6216; &#x8BE5;&#x7D22;&#x5F15;&#x8D85;&#x51FA;&#x8303;&#x56F4;&#xFF0C;&#x5219;&#x8FD4;&#x56DE;nil&#x3002;
 */
Class _objc_getClassForTag(objc_tag_index_t tag){
    Class *slot = classSlotForTagIndex(tag);
    if (slot) return *slot;
    else return nil;
}
</code></pre><p>&#x81F3;&#x6B64;&#xFF0C;&#x5173;&#x4E8E; &#x4F2A;&#x6307;&#x9488;<code>Tagged Pointer</code>&#xFF0C;&#x7B14;&#x8005;&#x5DF2;&#x7ECF;&#x8BB2;&#x5B8C;&#xFF01;</p>
<footer class="page-footer"><span class="copyright">Copyright &#x82CF;&#x6CAB;&#x79BB; all right reserved&#xFF0C;powered by Gitbook</span><span class="footer-modification">&#x4FEE;&#x8BA2;&#x65F6;&#x95F4;&#xFF1A;
2019-10-16 20:55:12
</span></footer>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> 搜索结果 "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">没有搜索结果 "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="+load方法的调用历程.html" class="navigation navigation-prev " aria-label="Previous page: +load方法">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="编译objc4.html" class="navigation navigation-next " aria-label="Next page: 编译objc4备忘录">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"TaggedPointer","level":"1.3.1.5","depth":3,"next":{"title":"编译objc4备忘录","level":"1.3.1.6","depth":3,"path":"iOS开发/Runtime/编译objc4.md","ref":"iOS开发/Runtime/编译objc4.md","articles":[]},"previous":{"title":"+load方法","level":"1.3.1.4","depth":3,"path":"iOS开发/Runtime/+load方法的调用历程.md","ref":"iOS开发/Runtime/+load方法的调用历程.md","articles":[]},"dir":"ltr"},"config":{"plugins":["highlight","-search","-lunr","search-pro","-sharing","splitter","expandable-chapters-small","expandable-chapters","code","back-to-top-button","anchor-navigation-ex","tbfed-pagefooter"],"root":"./","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"tbfed-pagefooter":{"copyright":"Copyright 苏沫离","modify_label":"修订时间：","modify_format":"2019-MM-DD HH:mm:ss"},"splitter":{},"search-pro":{},"code":{"copyButtons":true},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"anchor-navigation-ex":{"associatedWithSummary":true,"float":{"floatIcon":"fa fa-navicon","level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"mode":"float","multipleH1":true,"pageTop":{"level1Icon":"","level2Icon":"","level3Icon":"","showLevelIcon":false},"printLog":false,"showGoTop":false,"showLevel":false},"back-to-top-button":{},"expandable-chapters-small":{},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{}},"theme":"default","author":"苏莫离","pdf":{"pageNumbers":true,"fontSize":17,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":0,"left":0,"top":0,"bottom":0}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"个人博客","gitbook":"*","description":"苏莫离的个人博客","direction":"ltr"},"file":{"path":"iOS开发/Runtime/TaggedPointer.md","mtime":"2021-10-16T12:55:12.233Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-11-02T15:30:59.783Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

